---
import BaseLayout from "../../../../layouts/BaseLayout.astro";
import Breadcrumb from "../../../../components/Breadcrumb.astro";
import ContentSectionHeader from "../../../../components/ContentSectionHeader.astro";
import { getSpecialCourseById, getSpecialCourses } from "../../../../lib/microcms.ts";

// é™çš„ãƒ‘ã‚¹ç”Ÿæˆ
export async function getStaticPaths() {
  try {
    // å…¨ã¦ã®ç‰¹è¨­è¬›åº§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆå¹´åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãªã—ã§å…¨ä»¶å–å¾—ï¼‰
    const allCourses = await getSpecialCourses();
    
    if (!allCourses || allCourses.length === 0) {
      return [];
    }

    // winnersãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã™ã‚‹è¬›åº§ã®ã¿ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆ
    const coursesWithWinners = allCourses.filter(course => 
      course.winners && course.winners.trim().length > 0
    );

    // å„è¬›åº§ã®ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
    const paths = coursesWithWinners.map(course => ({
      params: { id: course.id },
      props: { course }
    }));

    return paths;
  } catch (error) {
    console.error('Error generating static paths for special course results:', error);
    return [];
  }
}

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
const { id } = Astro.params;
const { course } = Astro.props;

if (!id || !course) {
  return Astro.redirect('/404');
}

const breadcrumbItems = [
  { href: "/", label: "ãƒ›ãƒ¼ãƒ " },
  { href: "/results", label: "å½“é¸è€…ç™ºè¡¨" },
  { href: "/course/special-course", label: "ç‰¹è¨­è¬›åº§" },
  { label: `${course.title} å½“é¸è€…ç™ºè¡¨` }
];

// å‚åŠ æ„å‘ç¢ºèªãƒœã‚¿ãƒ³ã‚’å–å¾—
const intentionButtons = course.buttons?.filter((button: any) => {
  const buttonType = Array.isArray(button.type) ? button.type[0] : button.type;
  return button.visible && buttonType === "å‚åŠ æ„å‘ç¢ºèª";
}) || [];
---

<BaseLayout 
  title={`ç‰¹è¨­è¬›åº§ ${course.title} å½“é¸è€…ç™ºè¡¨`}
  description={`ã‚€ãªã‹ãŸå­ã©ã‚‚å¤§å­¦ç‰¹è¨­è¬›åº§ã€Œ${course.title}ã€ã®å½“é¸è€…ç™ºè¡¨ãƒšãƒ¼ã‚¸ã§ã™ã€‚å½“é¸ç•ªå·ã‚’ã”ç¢ºèªãã ã•ã„ã€‚`}
>
  <main>
    <!-- Custom Hero Section -->
    <section class="hero hero--special-course">
      <div class="hero__container">
        <div class="hero__content">
          <div class="hero__text fade-up">
            <h1 class="hero__title">
              <span class="hero__title-line1">ç‰¹è¨­è¬›åº§ {course.title}</span>
              <span class="hero__title-line2">å½“é¸è€…ç™ºè¡¨</span>
            </h1>
            <p class="hero__subtitle">Results - Special Course</p>
          </div>
        </div>
      </div>
    </section>

    <Breadcrumb items={breadcrumbItems} />

    <!-- Page Navigation -->
    <section class="page-nav">
      <div class="page-nav__container">
        <nav class="page-nav__menu">
          <a href="#procedures" class="page-nav__link">
            <div class="page-nav__arrow"></div>
            <span class="page-nav__text">ä»Šå¾Œã®æ‰‹é †</span>
          </a>
          <a href="#winner-list" class="page-nav__link">
            <div class="page-nav__arrow"></div>
            <span class="page-nav__text">å½“é¸è€…ä¸€è¦§</span>
          </a>
        </nav>
      </div>
    </section>

    <!-- ä»Šå¾Œã®æ‰‹é † Section -->
    <section id="procedures" class="content-section">
      <div class="content-section__container">
        <ContentSectionHeader 
          englishTitle=""
          title="ä»Šå¾Œã®æ‰‹é †"
          class="fade-up"
        />
        
        <div class="section-content">
          <!-- æœ¬çµæœã§æ±ºå®šã—ãŸã‚³ãƒ¼ã‚¹ã¸ã®å‚åŠ ã‚’ã•ã‚Œã‚‹æ–¹ -->
          <div class="procedure-box">
            <h3 class="procedure-box__title">æœ¬çµæœã§æ±ºå®šã—ãŸã‚³ãƒ¼ã‚¹ã¸ã®å‚åŠ ã‚’ã•ã‚Œã‚‹æ–¹</h3>
            
            <div class="procedure-box__content">
              <div class="step">
                <div class="step__header">
                  <span class="step__label">step</span>
                  <span class="step__number">01</span>
                </div>
                <h4 class="step__title">ç”³è¾¼æ™‚ã«ç™ºç•ªã•ã‚ŒãŸå—ä»˜ç•ªå·ã¨ã€æœ¬ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã®å‹Ÿé›†å½“é¸è€…ä¸€è¦§ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹å½“é¸ç•ªå·ã‚’ç…§ã‚‰ã—åˆã‚ã›ã¦ç¢ºèªã™ã‚‹ã€‚</h4>
                <p class="step__description"></p>
              </div>
              
              {intentionButtons.length > 0 && (
                <>
                  <div class="step-connector"></div>
                  
                  <div class="step">
                    <div class="step__header">
                      <span class="step__label">step</span>
                      <span class="step__number">02</span>
                    </div>
                    <h4 class="step__title">ä¸‹è¨˜ã®å‚åŠ æ„å‘ç¢ºèªãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒ³ã‚¯å‚åŠ æ„å‘ã‚’å…¥åŠ›ã™ã‚‹ã€‚</h4>
                    <p class="step__description">ã“ã¡ã‚‰ã®ãƒ•ã‚©ãƒ¼ãƒ ã¸å›ç­”ã„ãŸã ãã“ã¨ã§ã€å½“é¸ã‚³ãƒ¼ã‚¹ã¸ã®å‚åŠ ãŒç¢ºå®šã—ã¾ã™ã€‚æœŸæ—¥ã¾ã§ã«å…¥åŠ›ãŒãªã„å ´åˆã¯ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ‰±ã„ã¨ãªã‚Šã¾ã™ã®ã§ã€ã”ç†è§£ãã ã•ã„ã€‚</p>
                    
                    <div class="step__button-wrapper">
                      {intentionButtons.map((button) => {
                        // å¤–éƒ¨ãƒªãƒ³ã‚¯ã‹ã©ã†ã‹ã‚’åˆ¤å®š
                        const isExternalLink = button.url.startsWith('http://') || button.url.startsWith('https://');
                        
                        return (
                          <div class="step__button-item">
                            {button.labelAbove && (
                              <p class="step__button-label-above" set:html={button.labelAbove.replace(/\n/g, '<br>')}></p>
                            )}
                            <a 
                              href={button.url} 
                              class="step__button base-button base-button--blue"
                              target={isExternalLink ? '_blank' : undefined}
                              rel={isExternalLink ? 'noopener noreferrer' : undefined}
                            >
                              <span class="base-button__text" set:html={button.buttonText.replace(/\n/g, '<br>')}></span>
                              <div class="base-button__icon">
                                {isExternalLink ? (
                                  <div class="base-button__icon-external">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M18.2609 18.2609H1.73913V1.73913H6.95652V0H0.869565C0.389351 0 0 0.389351 0 0.869565V19.1304C0 19.6106 0.389351 20 0.869565 20H19.1304C19.6106 20 20 19.6106 20 19.1304V13.0435H18.2609V18.2609Z" fill="currentColor"/>
                                      <path d="M19.1304 0H11.3043V1.73913H17.0311L7.21118 11.559L8.44097 12.7888L18.2609 2.96892V8.69565H20V0.869565C20 0.389351 19.6106 0 19.1304 0Z" fill="currentColor"/>
                                    </svg>
                                  </div>
                                ) : (
                                  <div class="base-button__icon-arrow"></div>
                                )}
                              </div>
                            </a>
                            {button.labelBelow && (
                              <p class="step__button-label-below" set:html={button.labelBelow.replace(/\n/g, '<br>')}></p>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </>
              )}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- å½“é¸è€…ä¸€è¦§ Section -->
    <section id="winner-list" class="content-section">
      <div class="content-section__container">
        <ContentSectionHeader 
          englishTitle=""
          title="å½“é¸è€…ä¸€è¦§"
          class="fade-up"
        />
        
        <div class="section-content">
          <p class="winner-list-intro">ä¸‹è¨˜ã‚ˆã‚Šã€å½“é¸ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
          
          {course.winners && (
            <div class="rich-editor-content" set:html={course.winners}></div>
          )}
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<style lang="scss">
  @import "../../../../styles/index";

  .hero {
    position: relative;
    padding: 0;
    background: linear-gradient(to bottom, $brand-sub-turquoise 0%, $background-primary 70%, $background-primary 100%);
    border-radius: 0 rem(120) 0 0;
    
    @include breakpoint-up(md) {
      border-radius: 0 rem(240) 0 0;
    }

    &__container {
      margin: 0 auto;
      padding: 0 0 0 5%;
      overflow: hidden;
      position: relative;
      
      @include breakpoint-up(xl) {
        padding: 0 0 0 rem(50);
      }

      &::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        background-color: $brand-turquoise;
        z-index: -1;
      }
    }

    &__content {
      position: relative;
      padding: rem(100) 0 0;

      @include breakpoint-up(md) {
        padding: rem(120) 0 0;
      }
      @include breakpoint-up(xl) {
        padding: rem(160) 0 0;
      }
    }

    &__text {
      max-width: none;
      margin: 0;
      text-align: left;
    }

    &__title {
      @include font-ja-2l(semibold);
      font-weight: bold;
      color: $text-primary;
      margin: 0 0 rem(8) 0;
      line-height: 1.4;

      @include breakpoint-up(lg) {
        @include font-ja-3l(semibold);
        margin-bottom: rem(12);
      }

      .hero__title-line1 {
        display: block;
        @include font-ja-m(semibold);
        margin-bottom: rem(8);

        @include breakpoint-up(lg) {
          @include font-ja-l(semibold);
        }
      }

      .hero__title-line2 {
        display: block;
        @include font-ja-2l(semibold);
        font-weight: bold;
        line-height: 1.4;

        @include breakpoint-up(lg) {
          @include font-ja-3l(semibold);
        }
      }
    }

    &__subtitle {
      @include font-en-s(semibold);
      color: $brand-turquoise;
      margin: 0 0 rem(30) 0;
      font-weight: 500;
      letter-spacing: 0.05em;

      @include breakpoint-up(lg) {
        @include font-en-m(semibold);
        margin-bottom: 0;
      }
    }

  }

  .breadcrumb {
    padding: rem(20) 0;
    background: $background-primary;
    @include breakpoint-up(lg) {
      padding: rem(50) 0 rem(20);
    }

    &__container {
      margin: 0 auto;
      padding: 0 0 0 5%;
      @include breakpoint-up(xl) {
        padding: 0 0 0 rem(50);
      }
    }

    &__list {
      display: flex;
      align-items: center;
      gap: rem(8);
      list-style: none;
      margin: 0;
      padding: 0;
      @include font-ja-3s;
    }

    &__item {
      display: flex;
      align-items: center;

      &:not(:last-child)::after {
        content: '>';
        margin-left: rem(8);
        color: $text-secondary;
      }

      a {
        @include font-ja-3s(semibold);
        color: $text-link;
        text-decoration: underline;

        &:hover {
          color: $text-link-hover;
          text-decoration: underline;
        }
      }

      &[aria-current="page"] {
        @include font-ja-3s;
        color: $text-primary;
        font-weight: 500;
      }
    }
  }

  .page-nav {
    padding: rem(20) 0 0;
    background: $background-primary;

    &__container {
      margin: 0 auto;
      padding: 0 5%;
      @include breakpoint-up(xl) {
        padding: 0 rem(50);
      }
    }

    &__menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;

      @include breakpoint-up(sm) {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
      }
    }

    &__link {
      display: flex;
      align-items: center;
      gap: rem(5);
      color: $text-primary;
      text-decoration: none;
      transition: color 0.3s ease;
      padding: rem(6) rem(10);

      @include breakpoint-up(sm) {
        gap: rem(12);
        padding: rem(6) rem(20);
        border-right: 1px solid $border-secondary;
      }

      @include breakpoint-up(xl) {
        padding: rem(6) rem(30);
      }

      &:first-child {
        @include breakpoint-up(sm) {
          padding-left: 0;
        }
      }

      &:last-child {
        border-right: none;
      }

      &:hover {
        color: $brand-turquoise;
        text-decoration: none;

        .page-nav__arrow {
          transform: translateY(rem(6)) rotate(45deg);
        }
      }
    }

    &__text {
      @include font-ja-s(semibold);
    }

    &__arrow {
      width: rem(9);
      height: rem(9);
      border-right: 2px solid currentColor;
      border-bottom: 2px solid currentColor;
      transform: rotate(45deg);
      transition: transform 0.3s ease;
      flex-shrink: 0;
      margin-right: rem(3);
    }
  }

  .content-section {
    padding: rem(40) 0 rem(60);
    background: $background-primary;
    @include breakpoint-up(xl) {
      padding: rem(30) 0 rem(70);
    }

    &__container {
      margin: 0 auto;
      padding: 0 5%;
      overflow: hidden;
      @include breakpoint-up(xl) {
        padding: 0 rem(50);
      }
    }

    &__header {
      position: relative;
      margin-bottom: rem(50);
      margin-right: -5%;
      overflow: hidden;
      @include breakpoint-up(xl) {
        margin-bottom: rem(70);
        margin-right: 0;
      }
    }

    &__title-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: rem(8);
      z-index: 2;
      margin-top: rem(40);
      
      @include breakpoint-up(lg) {
        margin-top: rem(80);
      }
    }

    &__icon {
      width: rem(24);
      height: rem(24);
      flex-shrink: 0;
      margin-top: rem(2);

      @include breakpoint-up(lg) {
        width: rem(36);
        height: rem(36);
        margin-top: rem(4);
      }
    }

    &__title {
      @include font-ja-l(semibold);
      color: $text-primary;
      margin: 0;
      line-height: 1.4;

      @include breakpoint-up(lg) {
        @include font-ja-2l(semibold);
      }
    }
  }

  .section-content {
    // margin-top: rem(40);
    
    @include breakpoint-up(md) {
      // margin-top: rem(60);
    }
  }

  .content-placeholder {
    @include font-ja-s;
    color: $text-secondary;
    text-align: center;
    padding: rem(60) rem(20);
    background: $background-secondary;
    border-radius: $radius-m;
    margin: 0;
  }

  .procedure-box {
    border-radius: $radius-m;
    margin-bottom: rem(40);
    overflow: hidden;
    
    @include breakpoint-up(md) {
      border-radius: $radius-l;
    }
    
    @include breakpoint-up(lg) {
      margin-bottom: rem(60);
    }
    
    &:last-child {
      margin-bottom: 0;
    }
    
    &__title {
      @include font-ja-m(semibold);
      color: $text-primary;
      background-color: $brand-sub-turquoise;
      padding: rem(12) rem(16);
      border-radius: rem(8) rem(8) 0 0;
      line-height: 1.6;
      
      @include breakpoint-up(lg) {
        @include font-ja-l(semibold);
        padding: rem(16) rem(20);
      }
    }
    
    &__subtitle {
      @include font-ja-m(semibold);
      color: $text-primary;
      
      @include breakpoint-up(lg) {
        @include font-ja-l(semibold);
      }
    }
    
    &__content {
      border-left: 2px solid $brand-sub-turquoise;
      border-bottom: 2px solid $brand-sub-turquoise;
      border-right: 2px solid $brand-sub-turquoise;
      background-color: $background-primary !important;
      background-image: 
        radial-gradient(circle, $brand-sub-turquoise-low 1px, transparent 1px),
        radial-gradient(circle, $brand-sub-turquoise-low 1px, transparent 1px) !important;
      background-position: 0 0, 6.5px 6.5px !important;
      background-size: 13px 13px !important;
      padding: rem(30);
      border-radius: 0 0 $radius-m $radius-m;
      
      @include breakpoint-up(md) {
        padding: rem(36) rem(20);
        border-radius: 0 0 $radius-l $radius-l;
      }
      
      @include breakpoint-up(lg) {
        padding: rem(32) rem(30);
      }
      
      @include breakpoint-up(xl) {
        padding: rem(40) rem(40);
      }
    }
  }

  .step {
    margin-bottom: rem(20);
    
    @include breakpoint-up(lg) {
      margin-bottom: rem(25);
    }
    
    &:last-child {
      margin-bottom: 0;
    }
    
    &__header {
      display: flex;
      align-items: baseline;
      gap: rem(2);
      
      @include breakpoint-up(lg) {
      }
    }
    
    &__label {
      @include font-en-3s(semibold);
      color: $text-dark-gray;
    }
    
    &__number {
      @include font-en-s(semibold);
      color: $text-dark-gray;
    }
    
    &__title {
      @include font-ja-s(semibold);
      color: $text-secondary;
      margin: 0 0 rem(12) 0;
      line-height: 1.6;
      
      @include breakpoint-up(lg) {
        @include font-ja-m(semibold);
        margin-bottom: rem(16);
      }
    }
    
    &__description {
      @include font-ja-s;
      color: $text-primary;
      margin: 0;
      line-height: 1.7;
      
      &:empty {
        display: none;
      }
    }
    
    &__button-wrapper {
      margin-top: rem(20);
      display: flex;
      justify-content: center;
      
      @include breakpoint-up(md) {
        margin-top: rem(24);
      }
    }
    
    &__button-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    
    &__button-label-above {
      @include font-ja-s(semibold);
      color: $text-secondary;
      margin: 0 0 rem(12) 0;
      text-align: center;
      line-height: 1.6;
      
      @include breakpoint-up(md) {
        margin-bottom: rem(16);
      }
    }
    
    &__button-label-below {
      @include font-ja-s(semibold);
      color: $text-primary;
      margin: rem(5) 0 0 0;
      text-align: center;
      line-height: 1.6;
      
      @include breakpoint-up(md) {
        // margin-top: rem(12);
      }
    }
    
    &__button {
      color: $text-white !important;
      text-decoration: none !important;
      
      &:hover {
        color: $text-white !important;
        text-decoration: none !important;
      }
      
      &:focus {
        color: $text-white !important;
        text-decoration: none !important;
      }
      
      &:visited {
        color: $text-white !important;
        text-decoration: none !important;
      }
      
      .base-button__text {
        color: $text-white !important;
      }
    }
  }

  .step-connector {
    display: flex;
    align-items: center;
    margin: rem(20) 0;
    
    @include breakpoint-up(lg) {
      margin: rem(25) 0;
    }
    
    &::after {
      content: '';
      width: rem(12);
      height: rem(12);
      border-right: 2px solid $brand-turquoise;
      border-bottom: 2px solid $brand-turquoise;
      transform: rotate(45deg);
      
      @include breakpoint-up(lg) {
        width: rem(16);
        height: rem(16);
        border-right: 3px solid $brand-turquoise;
        border-bottom: 3px solid $brand-turquoise;
      }
    }
  }

  /* å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆSVGï¼‰ */
  :global(.base-button__icon-external) {
    width: rem(16);
    height: rem(16);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.5s ease;
    
    svg {
      width: 100%;
      height: 100%;
      transition: all 0.5s ease;
    }
  }

  // ãƒ–ãƒ«ãƒ¼ãƒœã‚¿ãƒ³ç”¨ã®å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³
  :global(.base-button--blue .base-button__icon-external) {
    color: $brand-primary;
  }

  :global(.base-button--blue:hover .base-button__icon-external) {
    color: $brand-secondary;
    transform: rotate(360deg);
  }

  .winner-list-intro {
    @include font-ja-s;
    color: $text-primary;
    margin: 0 0 rem(24) 0;
    
    @include breakpoint-up(md) {
      margin-bottom: rem(32);
    }
  }

  .rich-editor-content {
    // åŸºæœ¬ãƒ†ã‚­ã‚¹ãƒˆã¯regular
    @include font-ja-s;
    
    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¹…åˆ¶é™
    max-width: 100%;
    overflow: hidden;
    word-wrap: break-word;
    
    :global(h3), :global(h4), :global(h5) {
      @include font-ja-s(semibold);
      color: $text-primary;
      margin: rem(16) 0 rem(8) 0;
      font-weight: 600 !important; // semiboldã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
      font-size: inherit !important; // çµ±ä¸€ã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å¼·åˆ¶
    }
    
    :global(p) {
      @include font-ja-s; // regular
      color: $text-primary;
      margin: rem(8) 0;
      font-weight: 400 !important; // regularã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
      
      &:first-child {
        margin-top: 0;
      }
      
      &:last-child {
        margin-bottom: 0;
      }
    }
    
    :global(strong), :global(b) {
      font-weight: 600 !important; // semibold
    }
    
    // ã©ã‚“ãªè¦ç´ ã§ã‚ã£ã¦ã‚‚æœ€åˆã®è¦ç´ ã®margin-topã‚’0ã«ã™ã‚‹
    :global(*:first-child) {
      margin-top: 0 !important;
    }
    
    // æœ€å¾Œã®è¦ç´ ã®margin-bottomã‚‚0ã«ã—ã¦æ•´ãˆã‚‹
    :global(*:last-child) {
      margin-bottom: 0 !important;
    }
    
    :global(ul), :global(ol) {
      margin: rem(8) 0;
      padding-left: rem(20);
    }
    
    :global(ul) {
      list-style-type: disc;
    }
    
    :global(ol) {
      list-style-type: decimal;
    }
    
    :global(li) {
      @include font-ja-s; // regular
      color: $text-primary;
      margin-bottom: rem(4);
      font-weight: 400 !important; // regularã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
      
      &:last-child {
        margin-bottom: 0;
      }
    }
    
    // åŸ‹è¾¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«
    :global(iframe) {
      max-width: 100%;
      min-height: rem(400);
      height: auto;
      border: none;
      border-radius: rem(8);
      
      @include breakpoint-up(md) {
        min-height: rem(600);
      }
      
      @include breakpoint-up(lg) {
        min-height: rem(800);
      }
    }
    
    // PDFåŸ‹ã‚è¾¼ã¿ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«
    :global(embed[type="application/pdf"]) {
      width: 100%;
      min-height: rem(400);
      border: 1px solid $border-primary;
      border-radius: rem(8);
      
      @include breakpoint-up(md) {
        min-height: rem(600);
      }
      
      @include breakpoint-up(lg) {
        min-height: rem(800);
      }
    }
    
    // ç”»åƒç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¹…ã„ã£ã±ã„ã€ç¸¦æ¨ªæ¯”ä¿æŒï¼‰
    :global(img) {
      width: 100% !important;
      height: auto !important;
      border-radius: rem(4);
      margin: rem(8) 0;
      display: block;
    }
    
    :global(figure) {
      display: block;
      margin: rem(8) 0 !important;
      margin-left: 0 !important;
      margin-right: 0 !important;
      width: 100% !important;
      padding: 0;
      
      img {
        margin: 0;
        width: 100% !important;
        height: auto !important;
        display: block;
      }
    }
    
    :global(a) {
      @include font-ja-s(semibold);
      color: $text-link;
      text-decoration: underline;
      word-break: break-all;
      
      &:hover {
        color: $text-link-hover;
      }
    }
    
    // ãƒ†ãƒ¼ãƒ–ãƒ«ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«
    :global(table) {
      width: 100%;
      border-collapse: collapse;
      margin: rem(16) 0;
      
      th, td {
        @include font-ja-s;
        color: $text-primary;
        padding: rem(8) rem(12);
        border: 1px solid $border-primary;
        text-align: left;
        font-weight: 400 !important;
      }
      
      th {
        background-color: $background-secondary;
        font-weight: 600 !important;
      }
    }
    
    // PDF Canvasè¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«
    :global(.pdf-canvas-block) {
      border: 1px solid $border-primary;
      border-radius: rem(8);
      margin: rem(16) 0;
      overflow: hidden;
      background: $background-primary;
      max-width: rem(1200);
    }
    
    :global(.pdf-canvas-header) {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: rem(12) rem(16);
      background: $background-secondary;
      border-bottom: 1px solid $border-primary;
      flex-wrap: wrap;
      gap: rem(8);
      
      @include breakpoint-up(md) {
        align-items: center;
        flex-wrap: nowrap;
        gap: rem(16);
        padding: rem(16) rem(20);
      }
      
      h4 {
        @include font-ja-2s(semibold);
        color: $text-primary;
        margin: 0;
        flex: 1;
        min-width: rem(200);
        word-break: break-word;
        
        @include breakpoint-up(md) {
          @include font-ja-s(semibold);
          min-width: auto;
        }
      }
      
      .pdf-controls {
        display: flex;
        gap: rem(4);
        align-items: center;
        flex-wrap: wrap;
        justify-content: flex-end;
        
        @include breakpoint-up(md) {
          gap: rem(8);
          flex-wrap: nowrap;
        }
        
        button {
          @include font-ja-3s(semibold);
          color: $text-link;
          background: transparent;
          border: 1px solid $text-link;
          border-radius: rem(4);
          padding: rem(3) rem(6);
          cursor: pointer;
          transition: all 0.3s ease;
          white-space: nowrap;
          
          @include breakpoint-up(md) {
            @include font-ja-2s(semibold);
            padding: rem(4) rem(8);
          }
          
          &:hover {
            background: $text-link;
            color: $text-white;
          }
          
          &:disabled {
            opacity: 0.5;
            cursor: not-allowed;
          }
        }
        
        a {
          @include font-ja-3s(semibold);
          color: $text-link;
          text-decoration: none;
          padding: rem(3) rem(6);
          border: 1px solid $text-link;
          border-radius: rem(4);
          transition: all 0.3s ease;
          white-space: nowrap;
          
          @include breakpoint-up(md) {
            @include font-ja-2s(semibold);
            padding: rem(4) rem(8);
          }
          
          &:hover {
            background: $text-link;
            color: $text-white;
          }
        }
        
        span {
          @include font-ja-3s;
          color: $text-secondary;
          white-space: nowrap;
          
          @include breakpoint-up(md) {
            @include font-ja-2s;
          }
        }
      }
    }
    
    :global(.pdf-canvas-container) {
      position: relative;
      background: $brand-black;
      padding: rem(8);
      text-align: center;
      height: rem(400);
      overflow-y: auto;
      overflow-x: hidden;
      
      @include breakpoint-up(md) {
        padding: rem(16);
        height: rem(500);
      }
      
      @include breakpoint-up(lg) {
        padding: rem(20);
        height: rem(600);
      }
      
      .pdf-pages-container {
        display: flex;
        flex-direction: column;
        gap: rem(8);
        align-items: center;
      }
      
      .pdf-page-canvas {
        max-width: 100%;
        height: auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-radius: rem(4);
        display: block;
        margin: 0 auto;
        background: $text-white;
      }
      
      .pdf-loading {
        @include font-ja-2s;
        color: $text-secondary;
        padding: rem(20);
        
        @include breakpoint-up(md) {
          @include font-ja-s;
          padding: rem(40);
        }
      }
    }
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
// ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
document.addEventListener('DOMContentLoaded', function() {
  const navLinks = document.querySelectorAll('.page-nav__link');
  
  navLinks.forEach(link => {
    link.addEventListener('click', function(e: Event) {
      e.preventDefault();
      
      const target = e.currentTarget as HTMLAnchorElement;
      const href = target.getAttribute('href');
      const targetId = href?.substring(1);
      const targetElement = targetId ? document.getElementById(targetId) : null;
      
      if (targetElement) {
        targetElement.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
});

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®Intersection Observer
document.addEventListener('DOMContentLoaded', function() {
  const observerOptions = {
    threshold: 0.1, // è¦ç´ ã®10%ãŒè¦‹ãˆãŸã‚‰ç™ºç«
    rootMargin: '0px 0px -50px 0px' // ä¸‹ã‹ã‚‰50pxä½™è£•ã‚’æŒãŸã›ã‚‹
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        // ä¸€åº¦è¡¨ç¤ºã•ã‚ŒãŸã‚‰ç›£è¦–ã‚’åœæ­¢ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // fade-upã‚¯ãƒ©ã‚¹ã‚’æŒã¤å…¨ã¦ã®è¦ç´ ã‚’ç›£è¦–å¯¾è±¡ã«è¿½åŠ 
  const fadeUpElements = document.querySelectorAll('.fade-up');
  fadeUpElements.forEach(element => {
    observer.observe(element);
  });
});

// PDF Canvasè¡¨ç¤ºæ©Ÿèƒ½
document.addEventListener('DOMContentLoaded', function() {
  console.log('PDF.js loaded:', typeof pdfjsLib !== 'undefined');
  
  // PDF.jsã®è¨­å®š
  if (typeof pdfjsLib !== 'undefined') {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    // PDFãƒªãƒ³ã‚¯ã‚’è‡ªå‹•çš„ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«å¤‰æ›
    const pdfLinks = document.querySelectorAll('.rich-editor-content a[data-mime-type="application/pdf"]');
    console.log('PDF links found:', pdfLinks.length);
    
    pdfLinks.forEach(link => {
      const pdfUrl = link.href;
      const fileName = link.textContent.trim();
      
      // PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½œæˆ
      const pdfBlock = document.createElement('div');
      pdfBlock.className = 'pdf-canvas-block';
      pdfBlock.dataset.pdfUrl = pdfUrl;
      pdfBlock.innerHTML = `
        <div class="pdf-canvas-header">
          <h4>ğŸ“„ ${fileName}</h4>
          <div class="pdf-controls">
            <a href="${pdfUrl}" target="_blank">PDFã§é–‹ã</a>
          </div>
        </div>
        <div class="pdf-canvas-container">
          <div class="pdf-loading">PDFã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
          <div class="pdf-pages-container"></div>
        </div>
      `;
      
      // å…ƒã®ãƒªãƒ³ã‚¯ã‚’ç½®ãæ›ãˆ
      link.parentNode.replaceChild(pdfBlock, link);
    });
    
    // PDF Canvas ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‡¦ç†
    const pdfCanvasBlocks = document.querySelectorAll('.pdf-canvas-block');
    
    pdfCanvasBlocks.forEach(block => {
      const url = block.dataset.pdfUrl;
      const pagesContainer = block.querySelector('.pdf-pages-container');
      const loadingDiv = block.querySelector('.pdf-loading');
      
      let pdfDoc = null;
      
      // PDFã‚’èª­ã¿è¾¼ã¿
      pdfjsLib.getDocument(url).promise.then(pdf => {
        pdfDoc = pdf;
        const totalPages = pdf.numPages;
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
        if (loadingDiv) loadingDiv.style.display = 'none';
        
        // å…¨ãƒšãƒ¼ã‚¸ã‚’é †æ¬¡æç”»
        for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
          renderPage(pageNum, pagesContainer);
        }
        
      }).catch(error => {
        console.error('PDFèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        if (loadingDiv) {
          loadingDiv.textContent = 'PDFã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
        }
      });
      
      // ãƒšãƒ¼ã‚¸æç”»é–¢æ•°
      function renderPage(pageNum, container) {
        pdfDoc.getPage(pageNum).then(page => {
          // æ–°ã—ã„ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä½œæˆ
          const canvas = document.createElement('canvas');
          canvas.className = 'pdf-page-canvas';
          container.appendChild(canvas);
          
          // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
          const containerWidth = block.querySelector('.pdf-canvas-container').clientWidth - 32; // paddingåˆ†ã‚’å¼•ã
          
          // åŸºæœ¬ã‚¹ã‚±ãƒ¼ãƒ«ã‚’è¨­å®š
          let baseScale = 1.5;
          if (window.innerWidth < 768) {
            baseScale = 1.0; // ãƒ¢ãƒã‚¤ãƒ«
          } else if (window.innerWidth < 1024) {
            baseScale = 1.2; // ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ
          }
          
          const viewport = page.getViewport({ scale: baseScale });
          
          // ã‚³ãƒ³ãƒ†ãƒŠå¹…ã«åˆã‚ã›ã¦ã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´
          let finalScale = baseScale;
          if (viewport.width > containerWidth) {
            finalScale = (containerWidth / viewport.width) * baseScale;
          }
          
          const finalViewport = page.getViewport({ scale: finalScale });
          
          // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºè¨­å®š
          canvas.width = finalViewport.width;
          canvas.height = finalViewport.height;
          
          // é«˜DPIå¯¾å¿œ
          const devicePixelRatio = window.devicePixelRatio || 1;
          if (devicePixelRatio > 1) {
            canvas.width = finalViewport.width * devicePixelRatio;
            canvas.height = finalViewport.height * devicePixelRatio;
            canvas.style.width = finalViewport.width + 'px';
            canvas.style.height = finalViewport.height + 'px';
            
            const ctx = canvas.getContext('2d');
            ctx.scale(devicePixelRatio, devicePixelRatio);
            
            page.render({
              canvasContext: ctx,
              viewport: finalViewport
            });
          } else {
            // é€šå¸¸ã®æç”»
            const ctx = canvas.getContext('2d');
            page.render({
              canvasContext: ctx,
              viewport: finalViewport
            });
          }
        });
      }
      
      // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å†æç”»
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          if (pdfDoc && pagesContainer) {
            // æ—¢å­˜ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†æç”»
            pagesContainer.innerHTML = '';
            const totalPages = pdfDoc.numPages;
            for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
              renderPage(pageNum, pagesContainer);
            }
          }
        }, 300);
      });
    });
  }
});
</script>