---
import BaseLayout from "../../../../layouts/BaseLayout.astro";
import Breadcrumb from "../../../../components/Breadcrumb.astro";
import ContentSectionHeader from "../../../../components/ContentSectionHeader.astro";
import { getMainCampusSettings } from "../../../../lib/microcms.ts";

const breadcrumbItems = [
  { href: "/", label: "ãƒ›ãƒ¼ãƒ " },
  { href: "/results", label: "å½“é¸è€…ç™ºè¡¨" },
  { href: "/results", label: "ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹" },
  { label: "2æ¬¡ç”³è¾¼çµæœç™ºè¡¨" }
];

// ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹è¨­å®šã‚’å–å¾—
const mainCampusSettings = await getMainCampusSettings();
const finalEnrollmentData = mainCampusSettings.finalEnrollment;
---

<BaseLayout 
  title="ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ 2æ¬¡ç”³è¾¼çµæœç™ºè¡¨" 
  description="ã‚€ãªã‹ãŸå­ã©ã‚‚å¤§å­¦ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã®2æ¬¡ç”³è¾¼çµæœç™ºè¡¨ãƒšãƒ¼ã‚¸ã§ã™ã€‚æœ€çµ‚ç”³è¾¼çŠ¶æ³ä¸€è¦§ã‚’ã”ç¢ºèªãã ã•ã„ã€‚"
>
  <main>
    <!-- Custom Hero Section -->
    <section class="hero hero--main-campus">
      <div class="hero__container">
        <div class="hero__content">
          <div class="hero__text fade-up">
            <h1 class="hero__title">
              <span class="hero__title-line1">ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹</span>
              <span class="hero__title-line2">2æ¬¡ç”³è¾¼çµæœç™ºè¡¨</span>
            </h1>
            <p class="hero__subtitle">Results - Main Campus - Second</p>
          </div>
        </div>
      </div>
    </section>

    <Breadcrumb items={breadcrumbItems} />

    <!-- Page Navigation -->
    <section class="page-nav">
      <div class="page-nav__container">
        <nav class="page-nav__menu">
          <a href="#procedures" class="page-nav__link">
            <div class="page-nav__arrow"></div>
            <span class="page-nav__text">ä»Šå¾Œã®æ‰‹é †</span>
          </a>
          <a href="#final-enrollment" class="page-nav__link">
            <div class="page-nav__arrow"></div>
            <span class="page-nav__text">æœ€çµ‚ç”³è¾¼çŠ¶æ³ä¸€è¦§</span>
          </a>
        </nav>
      </div>
    </section>

    <!-- ä»Šå¾Œã®æ‰‹é † Section -->
    <section id="procedures" class="content-section">
      <div class="content-section__container">
        <ContentSectionHeader 
          englishTitle=""
          title="ä»Šå¾Œã®æ‰‹é †"
          class="fade-up"
        />
        
        <div class="section-content">
          <!-- å½“é¸ã•ã‚ŒãŸæ–¹ -->
          <div class="procedure-box">
            <h3 class="procedure-box__title">æœ¬çµæœã§æ±ºå®šã—ãŸã‚³ãƒ¼ã‚¹ã¸ã®å‚åŠ ã‚’ã•ã‚Œã‚‹æ–¹</h3>
            
            <div class="procedure-box__content">
              <div class="step">
                <h4 class="step__title">æœ¬ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã®æœ€çµ‚ç”³è¾¼çŠ¶æ³ä¸€è¦§ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ç•ªå·ã¨ã”è‡ªèº«ã®å—ä»˜ç•ªå·ã‚’ç…§ã‚‰ã—åˆã‚ã›ã€å‚åŠ æ±ºå®šã‚³ãƒ¼ã‚¹ã«é–“é•ã„ãªã„ã‹ç¢ºèªã™ã‚‹ã€‚</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- æœ€çµ‚ç”³è¾¼çŠ¶æ³ä¸€è¦§ Section -->
    <section id="final-enrollment" class="content-section">
      <div class="content-section__container">
        <ContentSectionHeader 
          englishTitle=""
          title="æœ€çµ‚ç”³è¾¼çŠ¶æ³ä¸€è¦§"
          class="fade-up"
        />
        
        <div class="section-content">
          <p class="winner-list-intro">ä¸‹è¨˜ã‹ã‚‰æœ€çµ‚ç”³è¾¼çŠ¶æ³ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
          
          {finalEnrollmentData && (
            <div class="rich-editor-content" set:html={finalEnrollmentData}></div>
          )}
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<style lang="scss">
  @import "../../../../styles/index";

  .breadcrumb {
    padding: rem(20) 0;
    background: $background-primary;
    @include breakpoint-up(lg) {
      padding: rem(50) 0 rem(20);
    }

    &__container {
      margin: 0 auto;
      padding: 0 0 0 5%;
      @include breakpoint-up(xl) {
        padding: 0 0 0 rem(50);
      }
    }

    &__list {
      display: flex;
      align-items: center;
      gap: rem(8);
      list-style: none;
      margin: 0;
      padding: 0;
      @include font-ja-3s;
    }

    &__item {
      display: flex;
      align-items: center;

      &:not(:last-child)::after {
        content: '>';
        margin-left: rem(8);
        color: $text-secondary;
      }

      a {
        @include font-ja-3s(semibold);
        color: $text-link;
        text-decoration: underline;

        &:hover {
          color: $text-link-hover;
          text-decoration: underline;
        }
      }

      &[aria-current="page"] {
        @include font-ja-3s;
        color: $text-primary;
        font-weight: 500;
      }
    }
  }

  .hero {
    position: relative;
    padding: 0;
    background: linear-gradient(to bottom, $brand-sub-yellow 0%, $background-primary 70%, $background-primary 100%);
    border-radius: 0 rem(120) 0 0;
    
    @include breakpoint-up(md) {
      border-radius: 0 rem(240) 0 0;
    }

    &__container {
      margin: 0 auto;
      padding: 0 0 0 5%;
      overflow: hidden;
      position: relative;
      
      @include breakpoint-up(xl) {
        padding: 0 0 0 rem(50);
      }

      &::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        background-color: $brand-secondary;
        z-index: -1;
      }
    }

    &__content {
      position: relative;
      padding: rem(100) 0 0;

      @include breakpoint-up(md) {
        padding: rem(120) 0 0;
      }
      @include breakpoint-up(xl) {
        padding: rem(160) 0 0;
      }
    }

    &__text {
      max-width: none;
      margin: 0;
      text-align: left;
    }

    &__title {
      @include font-ja-2l(semibold);
      font-weight: bold;
      color: $text-primary;
      margin: 0 0 rem(8) 0;
      line-height: 1.4;

      @include breakpoint-up(lg) {
        @include font-ja-3l(semibold);
        margin-bottom: rem(12);
      }

      .hero__title-line1 {
        display: block;
        @include font-ja-m(semibold);
        margin-bottom: rem(8);

        @include breakpoint-up(lg) {
          @include font-ja-l(semibold);
        }
      }

      .hero__title-line2 {
        display: block;
        @include font-ja-2l(semibold);
        font-weight: bold;
        line-height: 1.4;

        @include breakpoint-up(lg) {
          @include font-ja-3l(semibold);
        }
      }
    }

    &__subtitle {
      @include font-en-s(semibold);
      color: $brand-secondary;
      margin: 0 0 rem(30) 0;
      font-weight: 500;
      letter-spacing: 0.05em;

      @include breakpoint-up(lg) {
        @include font-en-m(semibold);
        margin-bottom: 0;
      }
    }
  }

  .page-nav {
    padding: rem(20) 0 0;
    background: $background-primary;

    &__container {
      margin: 0 auto;
      padding: 0 5%;
      @include breakpoint-up(xl) {
        padding: 0 rem(50);
      }
    }

    &__menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;

      @include breakpoint-up(sm) {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
      }
    }

    &__link {
      display: flex;
      align-items: center;
      gap: rem(5);
      color: $text-primary;
      text-decoration: none;
      transition: color 0.3s ease;
      padding: rem(6) rem(10);

      @include breakpoint-up(sm) {
        gap: rem(12);
        padding: rem(6) rem(20);
        border-right: 1px solid $border-secondary;
      }

      @include breakpoint-up(xl) {
        padding: rem(6) rem(30);
      }

      &:first-child {
        @include breakpoint-up(sm) {
          padding-left: 0;
        }
      }

      &:last-child {
        border-right: none;
      }

      &:hover {
        color: $brand-secondary;
        text-decoration: none;

        .page-nav__arrow {
          transform: translateY(rem(6)) rotate(45deg);
        }
      }
    }

    &__text {
      @include font-ja-s(semibold);
    }

    &__arrow {
      width: rem(9);
      height: rem(9);
      border-right: 2px solid currentColor;
      border-bottom: 2px solid currentColor;
      transform: rotate(45deg);
      transition: transform 0.3s ease;
      flex-shrink: 0;
      margin-right: rem(3);
    }
  }

  .content-section {
    padding: rem(40) 0 rem(60);
    background: $background-primary;
    @include breakpoint-up(xl) {
      padding: rem(30) 0 rem(70);
    }

    &__container {
      margin: 0 auto;
      padding: 0 5%;
      overflow: hidden;
      @include breakpoint-up(xl) {
        padding: 0 rem(50);
      }
    }

    &__header {
      position: relative;
      margin-bottom: rem(50);
      margin-right: -5%;
      overflow: hidden;
      @include breakpoint-up(xl) {
        margin-bottom: rem(70);
        margin-right: 0;
      }
    }

    &__title-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: rem(8);
      z-index: 2;
      margin-top: rem(40);
      
      @include breakpoint-up(lg) {
        margin-top: rem(80);
      }
    }

    &__icon {
      width: rem(24);
      height: rem(24);
      flex-shrink: 0;
      margin-top: rem(2);

      @include breakpoint-up(lg) {
        width: rem(36);
        height: rem(36);
        margin-top: rem(4);
      }
    }

    &__title {
      @include font-ja-l(semibold);
      color: $text-primary;
      margin: 0;
      line-height: 1.4;

      @include breakpoint-up(lg) {
        @include font-ja-2l(semibold);
      }
    }
  }

  .section-content {
    // margin-top: rem(40);
    
    @include breakpoint-up(md) {
      // margin-top: rem(60);
    }
  }

  .procedure-box {
    border-radius: $radius-m;
    margin-bottom: rem(40);
    overflow: hidden;
    
    @include breakpoint-up(md) {
      border-radius: $radius-l;
    }
    
    @include breakpoint-up(lg) {
      margin-bottom: rem(60);
    }
    
    &:last-child {
      margin-bottom: 0;
    }
    
    &__title {
      @include font-ja-m(semibold);
      color: $text-primary;
      background-color: $brand-sub-yellow;
      padding: rem(12) rem(16);
      border-radius: rem(8) rem(8) 0 0;
      line-height: 1.6;
      
      @include breakpoint-up(lg) {
        @include font-ja-l(semibold);
        padding: rem(16) rem(20);
      }
    }
    
    &__content {
      border-left: 2px solid $brand-sub-yellow;
      border-bottom: 2px solid $brand-sub-yellow;
      border-right: 2px solid $brand-sub-yellow;
      background-color: $background-primary !important;
      background-image: 
        radial-gradient(circle, #feecc5 1px, transparent 1px),
        radial-gradient(circle, #feecc5 1px, transparent 1px) !important;
      background-position: 0 0, 6.5px 6.5px !important;
      background-size: 13px 13px !important;
      padding: rem(30);
      border-radius: 0 0 $radius-m $radius-m;
      
      @include breakpoint-up(md) {
        padding: rem(36) rem(20);
        border-radius: 0 0 $radius-l $radius-l;
      }
      
      @include breakpoint-up(lg) {
        padding: rem(32) rem(30);
      }
      
      @include breakpoint-up(xl) {
        padding: rem(40) rem(40);
      }
    }
  }

  .step {    
    &__title {
      @include font-ja-s(semibold);
      color: $text-secondary;
      margin: 0;
      line-height: 1.6;
      
      @include breakpoint-up(lg) {
        @include font-ja-m(semibold);
      }
    }
  }

  .winner-list-intro {
    @include font-ja-s;
    color: $text-primary;
    margin: 0 0 rem(24) 0;
    
    @include breakpoint-up(md) {
      margin-bottom: rem(32);
    }
  }

  .rich-editor-content {
    // åŸºæœ¬ãƒ†ã‚­ã‚¹ãƒˆã¯regular
    @include font-ja-s;
    
    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¹…åˆ¶é™
    max-width: 100%;
    overflow: hidden;
    word-wrap: break-word;
    
    :global(h3), :global(h4), :global(h5) {
      @include font-ja-s(semibold);
      color: $text-primary;
      margin: rem(16) 0 rem(8) 0;
      font-weight: 600 !important; // semiboldã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
      font-size: inherit !important; // çµ±ä¸€ã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å¼·åˆ¶
    }
    
    :global(p) {
      @include font-ja-s; // regular
      color: $text-primary;
      margin: rem(8) 0;
      font-weight: 400 !important; // regularã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
      
      &:first-child {
        margin-top: 0;
      }
      
      &:last-child {
        margin-bottom: 0;
      }
    }
    
    :global(strong), :global(b) {
      font-weight: 600 !important; // semibold
    }
    
    // ã©ã‚“ãªè¦ç´ ã§ã‚ã£ã¦ã‚‚æœ€åˆã®è¦ç´ ã®margin-topã‚’0ã«ã™ã‚‹
    :global(*:first-child) {
      margin-top: 0 !important;
    }
    
    // æœ€å¾Œã®è¦ç´ ã®margin-bottomã‚‚0ã«ã—ã¦æ•´ãˆã‚‹
    :global(*:last-child) {
      margin-bottom: 0 !important;
    }
    
    // åŸ‹è¾¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«
    :global(iframe) {
      max-width: 100%;
      min-height: rem(400);
      height: auto;
      border: none;
      border-radius: rem(8);
      
      @include breakpoint-up(md) {
        min-height: rem(600);
      }
      
      @include breakpoint-up(lg) {
        min-height: rem(800);
      }
    }
    
    // PDF Canvasè¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«
    :global(.pdf-canvas-block) {
      border: 1px solid $border-primary;
      border-radius: rem(8);
      margin: rem(16) 0;
      overflow: hidden;
      background: $background-primary;
      max-width: rem(1200);
    }
    
    :global(.pdf-canvas-header) {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: rem(12) rem(16);
      background: $background-secondary;
      border-bottom: 1px solid $border-primary;
      flex-wrap: wrap;
      gap: rem(8);
      
      @include breakpoint-up(md) {
        align-items: center;
        flex-wrap: nowrap;
        gap: rem(16);
        padding: rem(16) rem(20);
      }
      
      h4 {
        @include font-ja-2s(semibold);
        color: $text-primary;
        margin: 0;
        flex: 1;
        min-width: rem(200);
        word-break: break-word;
        
        @include breakpoint-up(md) {
          @include font-ja-s(semibold);
          min-width: auto;
        }
      }
      
      .pdf-controls {
        display: flex;
        gap: rem(4);
        align-items: center;
        flex-wrap: wrap;
        justify-content: flex-end;
        
        @include breakpoint-up(md) {
          gap: rem(8);
          flex-wrap: nowrap;
        }
        
        button {
          @include font-ja-3s(semibold);
          color: $text-link;
          background: transparent;
          border: 1px solid $text-link;
          border-radius: rem(4);
          padding: rem(3) rem(6);
          cursor: pointer;
          transition: all 0.3s ease;
          white-space: nowrap;
          
          @include breakpoint-up(md) {
            @include font-ja-2s(semibold);
            padding: rem(4) rem(8);
          }
          
          &:hover {
            background: $text-link;
            color: $text-white;
          }
          
          &:disabled {
            opacity: 0.5;
            cursor: not-allowed;
          }
        }
        
        a {
          @include font-ja-3s(semibold);
          color: $text-link;
          text-decoration: none;
          padding: rem(3) rem(6);
          border: 1px solid $text-link;
          border-radius: rem(4);
          transition: all 0.3s ease;
          white-space: nowrap;
          
          @include breakpoint-up(md) {
            @include font-ja-2s(semibold);
            padding: rem(4) rem(8);
          }
          
          &:hover {
            background: $text-link;
            color: $text-white;
          }
        }
        
        span {
          @include font-ja-3s;
          color: $text-secondary;
          white-space: nowrap;
          
          @include breakpoint-up(md) {
            @include font-ja-2s;
          }
        }
      }
    }
    
    :global(.pdf-canvas-container) {
      position: relative;
      background: $brand-black;
      padding: rem(8);
      text-align: center;
      height: rem(400);
      overflow-y: auto;
      
      @include breakpoint-up(md) {
        padding: rem(16);
        height: rem(500);
      }
      
      @include breakpoint-up(lg) {
        padding: rem(20);
        height: rem(600);
      }
      
      canvas {
        max-width: 100%;
        height: auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-radius: rem(4);
        display: block;
        margin: 0 auto;
        background: $text-white;
      }
      
      .pdf-loading {
        @include font-ja-2s;
        color: $text-secondary;
        padding: rem(20);
        
        @include breakpoint-up(md) {
          @include font-ja-s;
          padding: rem(40);
        }
      }
    }
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
// ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
document.addEventListener('DOMContentLoaded', function() {
  const navLinks = document.querySelectorAll('.page-nav__link');
  
  navLinks.forEach(link => {
    link.addEventListener('click', function(e: Event) {
      e.preventDefault();
      
      const target = e.currentTarget as HTMLAnchorElement;
      const href = target.getAttribute('href');
      const targetId = href?.substring(1);
      const targetElement = targetId ? document.getElementById(targetId) : null;
      
      if (targetElement) {
        targetElement.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
});

// PDF Canvasè¡¨ç¤ºæ©Ÿèƒ½
document.addEventListener('DOMContentLoaded', function() {
  console.log('PDF.js loaded:', typeof pdfjsLib !== 'undefined');
  
  // PDF.jsã®è¨­å®š
  if (typeof pdfjsLib !== 'undefined') {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    // PDFãƒªãƒ³ã‚¯ã‚’è‡ªå‹•çš„ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«å¤‰æ›
    const pdfLinks = document.querySelectorAll('.rich-editor-content a[data-mime-type="application/pdf"]');
    console.log('PDF links found:', pdfLinks.length);
    
    pdfLinks.forEach(link => {
      const pdfUrl = link.href;
      const fileName = link.textContent.trim();
      
      // PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½œæˆ
      const pdfBlock = document.createElement('div');
      pdfBlock.className = 'pdf-canvas-block';
      pdfBlock.dataset.pdfUrl = pdfUrl;
      pdfBlock.innerHTML = `
        <div class="pdf-canvas-header">
          <h4>ğŸ“„ ${fileName}</h4>
          <div class="pdf-controls">
            <a href="${pdfUrl}" target="_blank">PDFã§é–‹ã</a>
          </div>
        </div>
        <div class="pdf-canvas-container">
          <div class="pdf-loading">PDFã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
          <div class="pdf-pages-container"></div>
        </div>
      `;
      
      // å…ƒã®ãƒªãƒ³ã‚¯ã‚’ç½®ãæ›ãˆ
      link.parentNode.replaceChild(pdfBlock, link);
    });
    
    // PDF Canvas ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‡¦ç†
    const pdfCanvasBlocks = document.querySelectorAll('.pdf-canvas-block');
    
    pdfCanvasBlocks.forEach(block => {
      const url = block.dataset.pdfUrl;
      const pagesContainer = block.querySelector('.pdf-pages-container');
      const loadingDiv = block.querySelector('.pdf-loading');
      
      let pdfDoc = null;
      
      // PDFã‚’èª­ã¿è¾¼ã¿
      pdfjsLib.getDocument(url).promise.then(pdf => {
        pdfDoc = pdf;
        const totalPages = pdf.numPages;
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
        if (loadingDiv) loadingDiv.style.display = 'none';
        
        // å…¨ãƒšãƒ¼ã‚¸ã‚’é †æ¬¡æç”»
        for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
          renderPage(pageNum, pagesContainer);
        }
        
      }).catch(error => {
        console.error('PDFèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        if (loadingDiv) {
          loadingDiv.textContent = 'PDFã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
        }
      });
      
      // ãƒšãƒ¼ã‚¸æç”»é–¢æ•°
      function renderPage(pageNum, container) {
        pdfDoc.getPage(pageNum).then(page => {
          // æ–°ã—ã„ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä½œæˆ
          const canvas = document.createElement('canvas');
          canvas.className = 'pdf-page-canvas';
          container.appendChild(canvas);
          
          // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
          const containerWidth = block.querySelector('.pdf-canvas-container').clientWidth - 32; // paddingåˆ†ã‚’å¼•ã
          
          // åŸºæœ¬ã‚¹ã‚±ãƒ¼ãƒ«ã‚’è¨­å®š
          let baseScale = 1.5;
          if (window.innerWidth < 768) {
            baseScale = 1.0; // ãƒ¢ãƒã‚¤ãƒ«
          } else if (window.innerWidth < 1024) {
            baseScale = 1.2; // ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ
          }
          
          const viewport = page.getViewport({ scale: baseScale });
          
          // ã‚³ãƒ³ãƒ†ãƒŠå¹…ã«åˆã‚ã›ã¦ã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´
          let finalScale = baseScale;
          if (viewport.width > containerWidth) {
            finalScale = (containerWidth / viewport.width) * baseScale;
          }
          
          const finalViewport = page.getViewport({ scale: finalScale });
          
          // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºè¨­å®š
          canvas.width = finalViewport.width;
          canvas.height = finalViewport.height;
          
          // é«˜DPIå¯¾å¿œ
          const devicePixelRatio = window.devicePixelRatio || 1;
          if (devicePixelRatio > 1) {
            canvas.width = finalViewport.width * devicePixelRatio;
            canvas.height = finalViewport.height * devicePixelRatio;
            canvas.style.width = finalViewport.width + 'px';
            canvas.style.height = finalViewport.height + 'px';
            
            const ctx = canvas.getContext('2d');
            ctx.scale(devicePixelRatio, devicePixelRatio);
            
            page.render({
              canvasContext: ctx,
              viewport: finalViewport
            });
          } else {
            // é€šå¸¸ã®æç”»
            const ctx = canvas.getContext('2d');
            page.render({
              canvasContext: ctx,
              viewport: finalViewport
            });
          }
        });
      }
      
      // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å†æç”»
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          if (pdfDoc && pagesContainer) {
            // æ—¢å­˜ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†æç”»
            pagesContainer.innerHTML = '';
            const totalPages = pdfDoc.numPages;
            for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
              renderPage(pageNum, pagesContainer);
            }
          }
        }, 300);
      });
    });
  }
});

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®Intersection Observer
document.addEventListener('DOMContentLoaded', function() {
  const observerOptions = {
    threshold: 0.1, // è¦ç´ ã®10%ãŒè¦‹ãˆãŸã‚‰ç™ºç«
    rootMargin: '0px 0px -50px 0px' // ä¸‹ã‹ã‚‰50pxä½™è£•ã‚’æŒãŸã›ã‚‹
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        // ä¸€åº¦è¡¨ç¤ºã•ã‚ŒãŸã‚‰ç›£è¦–ã‚’åœæ­¢ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // fade-upã‚¯ãƒ©ã‚¹ã‚’æŒã¤å…¨ã¦ã®è¦ç´ ã‚’ç›£è¦–å¯¾è±¡ã«è¿½åŠ 
  const fadeUpElements = document.querySelectorAll('.fade-up');
  fadeUpElements.forEach(element => {
    observer.observe(element);
  });
});
</script>