---
import BaseLayout from '@/layouts/BaseLayout.astro';
import HeroSection from '@/components/HeroSection.astro';
import Breadcrumb from '@/components/Breadcrumb.astro';
import ContentSectionHeader from '@/components/ContentSectionHeader.astro';
import CourseCard from '@/components/CourseCard.astro';
import AfterImagesSlider from '@/components/AfterImagesSlider.astro';
import { 
  getGlobalSettings,
  getSummerCourses,
  getSummerCategories
} from '@/lib/microcms';
import { convertYearToPath, convertPathToYear } from '@/utils/yearConverter';
import { formatDateForCourse, convertUTCToJST, extractJSTDateParts } from '@/utils/dateUtils';

// é™çš„ãƒ‘ã‚¹ç”Ÿæˆ
export async function getStaticPaths() {
  try {
    // å…¨ã¦ã®è¬›åº§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    console.log('=== getStaticPaths: Starting getSummerCourses ===');
    const allCourses = await getSummerCourses();
    console.log(`=== getStaticPaths: Retrieved ${allCourses?.length || 0} courses ===`);
    
    if (!allCourses || allCourses.length === 0) {
      console.log('=== getStaticPaths: No courses found, returning empty array ===');
      return [];
    }

    // å„å¹´åº¦ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ‘ã‚¹ã‚’ç”Ÿæˆ
    const uniqueYears = [...new Set(allCourses.map(course => {
      return Array.isArray(course.year) ? course.year[0] : course.year;
    }))];

    const paths = uniqueYears.map(originalYear => {
      const pathYear = convertYearToPath(originalYear);
      return {
        params: { year: pathYear },
        props: { originalYear, pathYear }
      };
    });
    
    console.log(`=== getStaticPaths: Generated ${paths.length} paths ===`);
    console.log('=== getStaticPaths: Paths:', paths.map(p => p.params.year));

    return paths;
  } catch (error) {
    console.error('Error generating static paths for summer course year pages:', error);
    return [];
  }
}

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
const { year } = Astro.params;
const { originalYear, pathYear } = Astro.props;

if (!year) {
  return Astro.redirect('/404');
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã‚’å–å¾—
const globalSettings = await getGlobalSettings();
const currentYear = Array.isArray(globalSettings.currentYear) ? globalSettings.currentYear[0] : globalSettings.currentYear;
const currentYearPath = convertYearToPath(currentYear);

// ãƒ‘ã‚¹ã‹ã‚‰å¹´åº¦ã‚’å¾©å…ƒ
const actualYear = originalYear || convertPathToYear(year);

// ç¾åœ¨å¹´åº¦ã®å ´åˆã¯ /course/summer-course ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
if (year === currentYearPath) {
  return Astro.redirect('/course/summer-course', 301);
}

// éå»å¹´åº¦ã®è¬›åº§ä¸€è¦§ã‚’å–å¾—
console.log(`Fetching courses for actualYear: ${actualYear}`);
const courses = await getSummerCourses(actualYear);

// ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå…¨å¹´åº¦ã®ãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—ã—ã¦æ¯”è¼ƒ
const allCoursesDebug = await getSummerCourses();
console.log(`All available courses: ${allCoursesDebug.length}`);
console.log('Available years:', [...new Set(allCoursesDebug.map(c => Array.isArray(c.year) ? c.year[0] : c.year))]);

// å¤èª²å¤–ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const summerCategories = await getSummerCategories();

// è©²å½“å¹´åº¦ã®è¬›åº§ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯404
if (!courses || courses.length === 0) {
  return Astro.redirect('/404');
}

// å¹´åº¦è¡¨ç¤ºç”¨ï¼ˆä»¤å’Œâ—‹å¹´åº¦ã‹ã‚‰â—‹éƒ¨åˆ†ã‚’æŠ½å‡ºï¼‰
const reiwaYear = actualYear.replace('ä»¤å’Œ', '').replace('å¹´åº¦', '');

// ãƒšãƒ¼ã‚¸æƒ…å ±
const pageTitle = `éå»ã®å®Ÿç¸¾ï¼ˆ${actualYear}ï¼‰- å¤ã®èª²å¤–æˆæ¥­`;
const pageDescription = `${actualYear}ã®å¤ã®èª²å¤–æˆæ¥­å®Ÿç¸¾ã€‚å¸‚å†…å¤–å•ã‚ãšã€å¹…åºƒã„å¹´é½¢ã®å­ã©ã‚‚ãŸã¡ãŒå‚åŠ ã§ãã‚‹ä½“é¨“æ´»å‹•ã§ã€å¤ä¼‘ã¿æœŸé–“ä¸­ã«å¤šæ•°é–‹å‚¬ã—ã¾ã—ãŸã€‚`;

// ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ
const breadcrumbItems = [
  { label: 'ãƒ›ãƒ¼ãƒ ', href: '/' },
  { label: 'è¬›åº§å†…å®¹', href: '/course' },
  { label: 'å¤ã®èª²å¤–æˆæ¥­', href: '/course/summer-course' },
  { label: `${actualYear}` }
];

// è¬›åº§ã‚«ãƒ¼ãƒ‰ç”¨ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼ˆé–‹å‚¬æ—¥ã”ã¨ã«åˆ†å‰²å¯¾å¿œï¼‰
// ãƒ‡ãƒãƒƒã‚°: å®Ÿéš›ã®coursesãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ç¢ºèª
console.log(`=== Summer Course Year Page Debug ===`);
console.log(`URL year parameter: ${year}`);
console.log(`Actual year for filtering: ${actualYear}`);
console.log(`Total courses retrieved: ${courses.length}`);
console.log('Raw courses data:', JSON.stringify(courses.slice(0, 2), null, 2));

const courseYearPath = convertYearToPath(actualYear);
// è¬›åº§ã‚«ãƒ¼ãƒ‰ä½œæˆã‚’å®‰å…¨ã«å®Ÿè¡Œ
let courseCards = [];
try {
  courseCards = courses.flatMap(course => {
    console.log(`Course ${course.id} schedule:`, course.schedule);
    console.log(`Course ${course.id} full data:`, {
      executedDate: course.executedDate,
      startTime: course.startTime,
      endTime: course.endTime,
      atAnyTime: course.atAnyTime,
      atAnyTimeType: typeof course.atAnyTime,
      date: course.date,
      scheduleLength: course.schedule?.length
    });
    
    // scheduleãŒå­˜åœ¨ã—ã€è¤‡æ•°ã®é–‹å‚¬æ—¥ãŒã‚ã‚‹å ´åˆã¯åˆ†å‰²
    if (course.schedule && course.schedule.length > 0) {
      return course.schedule.map((scheduleItem, index) => {
        const urlSuffix = course.schedule.length > 1 ? `-${index + 1}` : '';
        const scheduleTitle = course.schedule.length > 1 ? 
          `${course.title} (${index + 1}å›ç›®)` : course.title;
        
        console.log(`Schedule item ${index}:`, scheduleItem);
        
        return {
          id: `${course.id}${urlSuffix}`,
          title: scheduleTitle,
          subtitle: course.subtitle,
          thumbImg: course.thumbImg,
          status: 'å‹Ÿé›†çµ‚äº†', // éå»å¹´åº¦ã¯å…¨ã¦å‹Ÿé›†çµ‚äº†
          year: course.year,
          href: `/course/summer-course/${courseYearPath}/${course.id}${urlSuffix}`,
          providerNames: course.providerInfo?.map(item => item.providerName).join('ã€') || '',
          targetGrades: Array.isArray(course.targetGrades) ? course.targetGrades : (course.targetGrades ? [course.targetGrades] : []),
          category: (typeof course.category === 'object' && course.category?.category) ? course.category.category : (course.category || 'ãã®ä»–'),
          courseType: (Array.isArray(course.courseType) ? course.courseType[0] : course.courseType)?.toString().trim() || 'undefined',
          hasReport: !!(course.afterImages?.length || course.instructor || course.afterReport || course.participantCount),
          scheduleDate: scheduleItem.date || course.date,
          executedDate: scheduleItem.executedDate || course.executedDate,
          startTime: scheduleItem.startTime || course.startTime,
          endTime: scheduleItem.endTime || course.endTime,
          atAnyTime: scheduleItem.atAnyTime || course.atAnyTime,
          residencyText: course.cityOutsideOk ? 'å¸‚å†…ãƒ»å¸‚å¤–åœ¨ä½ã®' : 'å¸‚å†…åœ¨ä½ã®',
          parentJoinText: '' // getParentJoinText(course.parentJoin)
        };
      });
    } else {
      // scheduleãŒå­˜åœ¨ã—ãªã„å ´åˆã¯courseãƒ¬ãƒ™ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
      return [{
        id: course.id,
        title: course.title,
        subtitle: course.subtitle,
        thumbImg: course.thumbImg,
        status: 'å‹Ÿé›†çµ‚äº†', // éå»å¹´åº¦ã¯å…¨ã¦å‹Ÿé›†çµ‚äº†
        year: course.year,
        href: `/course/summer-course/${courseYearPath}/${course.id}`,
        providerNames: course.providerInfo?.map(item => item.providerName).join('ã€') || '',
        targetGrades: Array.isArray(course.targetGrades) ? course.targetGrades : (course.targetGrades ? [course.targetGrades] : []),
        category: (typeof course.category === 'object' && course.category?.category) ? course.category.category : (course.category || 'ãã®ä»–'),
        courseType: (Array.isArray(course.courseType) ? course.courseType[0] : course.courseType)?.toString().trim() || 'undefined',
        hasReport: !!(course.afterImages?.length || course.instructor || course.afterReport || course.participantCount),
        scheduleDate: course.date,
        executedDate: course.executedDate,
        startTime: course.startTime,
        endTime: course.endTime,
        atAnyTime: course.atAnyTime,
        residencyText: course.cityOutsideOk ? 'å¸‚å†…ãƒ»å¸‚å¤–åœ¨ä½ã®' : 'å¸‚å†…åœ¨ä½ã®',
        parentJoinText: '' // getParentJoinText(course.parentJoin)
      }];
    }
  });
} catch (error) {
  console.error('Error creating courseCards:', error);
  courseCards = [];
}

// ãƒ‡ãƒãƒƒã‚°: courseCardsä½œæˆå¾Œã®ç¢ºèª
console.log('Final courseCards count:', courseCards.length);
console.log('CourseCards type:', typeof courseCards);
console.log('CourseCards is array?', Array.isArray(courseCards));
console.log('CourseCards length for template:', courseCards.length);
console.log('CourseCards schedule info:');
courseCards.forEach((card, index) => {
  if (index < 5) {
    console.log(`Card ${index} (${card.title}):`, {
      scheduleDate: card.scheduleDate,
      atAnyTime: card.atAnyTime,
      executedDate: card.executedDate,
      startTime: card.startTime,
      endTime: card.endTime,
      willShowScheduleDate: !!(card.scheduleDate || card.atAnyTime),
      residencyText: card.residencyText,
      hasResidencyText: !!card.residencyText
    });
  }
});

// å…¨è¬›åº§ã®afterImagesã‚’åé›†
const allAfterImages = courses.reduce((acc, course) => {
  if (course.afterImages && course.afterImages.length > 0) {
    acc.push(...course.afterImages);
  }
  return acc;
}, []);

// å¹´åº¦è¡¨ç¤ºç”¨ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
function formatYear(year) {
  return year.replace('ä»¤å’Œ', '').replace('å¹´åº¦', '');
}

// UTCå®Ÿæ–½æ—¥ã‚’JSTã«å¤‰æ›ã—ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹é–¢æ•°
function formatExecutedDate(utcDateString: string): string {
  if (!utcDateString) return '';
  return formatDateForCourse(utcDateString);
}

// å­¦å¹´ã®æ•´åˆ—é †åºé–¢æ•°ï¼ˆscheduleãƒšãƒ¼ã‚¸ã¨åŒæ§˜ï¼‰
function formatTargetGrades(targetGrades: string | string[]): { sortedGrades: string[]; htmlString: string } {
  const grades = Array.isArray(targetGrades) ? targetGrades : [targetGrades];
  
  // å­¦å¹´ã®è¡¨ç¤ºé †ã‚’æ±ºã‚ã‚‹é–¢æ•°
  function getGradeOrder(grade: string): number {
    // æœªå°±å­¦å…ã¯æœ€åˆ
    if (grade === 'æœªå°±å­¦å…') {
      return 0;
    }
    
    // 1å¹´ï½9å¹´ï¼ˆå°ä¸­å­¦æ ¡ï¼‰
    const elementaryJuniorMatch = grade.match(/^(\d+)å¹´$/);
    if (elementaryJuniorMatch && elementaryJuniorMatch[1]) {
      const num = parseInt(elementaryJuniorMatch[1]);
      if (num >= 1 && num <= 9) {
        return num; // 1ï½9ã®é †åº
      }
    }
    
    // é«˜1ï½é«˜3ï¼ˆé«˜æ ¡ï¼‰
    const highSchoolMatch = grade.match(/^é«˜(\d+)$/);
    if (highSchoolMatch && highSchoolMatch[1]) {
      const num = parseInt(highSchoolMatch[1]);
      if (num >= 1 && num <= 3) {
        return 10 + num; // 11ï½13ã®é †åºï¼ˆ10 + 1ï½3ï¼‰
      }
    }
    
    // ãã®ä»–ã¯æœ€å¾Œ
    return 999;
  }
  
  // å­¦å¹´ã‚’æŒ‡å®šã•ã‚ŒãŸé †åºã§ã‚½ãƒ¼ãƒˆ
  const sortedGrades = grades.sort((a, b) => {
    return getGradeOrder(a) - getGradeOrder(b);
  });
  
  return {
    sortedGrades,
    htmlString: sortedGrades.join('ãƒ»') // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚
  };
}

// ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¹´åº¦è¡¨ç¤ºç”¨ã®è‹±èªè¡¨è¨˜
const reiwaNumber = reiwaYear;

// å­¦å¹´ã®è‰²åˆ†ã‘ã‚¯ãƒ©ã‚¹å–å¾—é–¢æ•°ï¼ˆscheduleãƒšãƒ¼ã‚¸ã¨åŒæ§˜ï¼‰
function getGradeColorClass(grade: string): string {
  // ã‚€ãªã‹ãŸå­ã©ã‚‚å¤§å­¦ã®æ—¥ï¼ˆå­¦æ ¡åï¼‰ã®å ´åˆ
  if (grade.includes('å°å­¦æ ¡') || grade.includes('ä¸­å­¦æ ¡') || grade.includes('å­¦æ ¡') || grade.includes('å­¦åœ’')) {
    return 'mku-day';
  }
  
  // ç‰¹æ®Šãªã‚±ãƒ¼ã‚¹
  if (grade === 'æœªå°±å­¦å…' || grade === 'ã ã‚Œã§ã‚‚' || grade.includes('ãã®ä»–')) {
    return 'special';
  }
  
  // æ•°å­—ã‚’æŠ½å‡º
  const yearMatch = grade.match(/^(\d+)å¹´$/);
  if (yearMatch) {
    const num = parseInt(yearMatch[1]);
    if (num >= 1 && num <= 3) return 'elementary-low';    // 1~3å¹´
    if (num >= 4 && num <= 6) return 'elementary-high';   // 4~6å¹´
    if (num >= 7 && num <= 9) return 'junior';            // 7~9å¹´
  }
  
  // é«˜æ ¡ç”Ÿ
  if (grade.match(/^é«˜\d+$/)) {
    return 'high-school'; // é«˜æ ¡ç”Ÿå°‚ç”¨ã®è‰²
  }
  
  // ãã®ä»–
  return 'special';
}

function getParentJoinText(parentJoin: any): string {
  // parentJoinå€¤ã®è¡¨ç¤ºç”¨å¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°
  const parentJoinMapping: Record<string, string> = {
    'r0A1BukTIs': 'ä¿è­·è€…ã®æ–¹ã‚‚å‚åŠ ã§ãã¾ã™',
    '87MGdHzdV4': 'ä¿è­·è€…ã®æ–¹ã¯å‚åŠ ã§ãã¾ã›ã‚“',
    'FEytb3Ezyt': 'ä¿è­·è€…ã®æ–¹ã®å‚åŠ ãŒå¿…é ˆã§ã™'
  };

  if (!parentJoin) return '';
  
  const parentJoinStr = typeof parentJoin === 'string' ? parentJoin : (Array.isArray(parentJoin) ? parentJoin[0] : '');
  
  if (parentJoinStr && parentJoinStr !== 'é¸æŠã—ã¦ãã ã•ã„' && parentJoinStr.trim() !== '') {
    const displayText = parentJoinMapping[parentJoinStr] || parentJoinStr;
    return displayText;
  }
  
  return '';
}
---

<BaseLayout 
  title={pageTitle} 
  description={pageDescription}
  noIndex={false}
>
  <main>
    <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="hero hero--summer-course">
      <div class="hero__container">
        <div class="hero__content">
          <div class="hero__text fade-up">
            <h1 class="hero__title">
              <span class="hero__title-line1">å¤ã®èª²å¤–æˆæ¥­</span>
              <span class="hero__title-line2">éå»ã®å®Ÿç¸¾<br class="sm-only">({actualYear})</span>
            </h1>
            <p class="hero__subtitle">Report - Summer Course - Reiwa {reiwaNumber}</p>
          </div>
        </div>
      </div>
    </section>

    <Breadcrumb items={breadcrumbItems} />

    <!-- è¬›åº§ã®æ§˜å­ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ -->
    {allAfterImages.length > 0 && (
      <AfterImagesSlider images={allAfterImages} class="fade-up" />
    )}

    <!-- è¬›åº§ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="courses" class="courses-section content-section">
      <div class="content-section__container">
        <ContentSectionHeader 
          englishTitle=""
          title={`${actualYear} ã‚³ãƒ¼ã‚¹ä¸€è¦§`}
          customTitleWrapperStyle="courses-title-wrapper"
          customIconStyle="courses-icon"
          class="fade-up"
        />
        
        <!-- DEBUG: courseCards.length = {courseCards?.length || 0} -->
        {courseCards && courseCards.length > 0 ? (
          <div class="courses-section">
            <div class="filter-tabs">
              <button class="filter-tab filter-tab--active" data-sort="date">æ—¥ä»˜ã‹ã‚‰æ¢ã™</button>
              <button class="filter-tab" data-sort="category">ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‹ã‚‰æ¢ã™</button>
            </div>
            <div class="courses-container">
            
            <!-- ã‚«ãƒ¼ãƒ‰è‰²åˆ†ã‘å‡¡ä¾‹ -->
            <div class="course-legend">
              <div class="course-legend__item">
                <div class="course-legend__color course-legend__color--job-experience"></div>
                <span class="course-legend__label">è·æ¥­ä½“é¨“</span>
              </div>
              <div class="course-legend__item">
                <div class="course-legend__color course-legend__color--hands-on"></div>
                <span class="course-legend__label">ä½“é¨“æ´»å‹•</span>
              </div>
            </div>
            
            <!-- æ™‚æœŸåˆ¥ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ -->
            <div class="period-scroll-links" id="period-scroll-links" 
                 data-category-order={JSON.stringify(summerCategories?.map(cat => cat.category) || [])}
                 style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin: 16px 0 24px 0;">
              <a href="#" class="period-link" data-period="late-july" 
                 style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 600; padding: 4px 12px 4px 8px; border: 1px solid #1c0083; border-radius: 10px; white-space: nowrap; color: #1c0083; background-color: #ffffff; text-decoration: none; transition: all 0.2s ease; cursor: pointer;">
                7æœˆä¸‹æ—¬ <span class="period-link__arrow"></span>
              </a>
              <a href="#" class="period-link" data-period="early-august" 
                 style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 600; padding: 4px 12px 4px 8px; border: 1px solid #1c0083; border-radius: 10px; white-space: nowrap; color: #1c0083; background-color: #ffffff; text-decoration: none; transition: all 0.2s ease; cursor: pointer;">
                8æœˆä¸Šæ—¬ <span class="period-link__arrow"></span>
              </a>
              <a href="#" class="period-link" data-period="mid-august" 
                 style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 600; padding: 4px 12px 4px 8px; border: 1px solid #1c0083; border-radius: 10px; white-space: nowrap; color: #1c0083; background-color: #ffffff; text-decoration: none; transition: all 0.2s ease; cursor: pointer;">
                8æœˆä¸­æ—¬ <span class="period-link__arrow"></span>
              </a>
              <a href="#" class="period-link" data-period="late-august" 
                 style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 600; padding: 4px 12px 4px 8px; border: 1px solid #1c0083; border-radius: 10px; white-space: nowrap; color: #1c0083; background-color: #ffffff; text-decoration: none; transition: all 0.2s ease; cursor: pointer;">
                8æœˆä¸‹æ—¬ <span class="period-link__arrow"></span>
              </a>
              <a href="#" class="period-link" data-period="anytime" 
                 style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 600; padding: 4px 12px 4px 8px; border: 1px solid #1c0083; border-radius: 10px; white-space: nowrap; color: #1c0083; background-color: #ffffff; text-decoration: none; transition: all 0.2s ease; cursor: pointer;">
                éšæ™‚é–‹å‚¬ <span class="period-link__arrow"></span>
              </a>
            </div>
            
            <div class="courses-grid" id="courses-grid">
              {courseCards.map(course => (
              <a href={course.href} class={`course-card ${course.courseType ? 'course-card--' + course.courseType : ''}`} data-schedule-date={course.scheduleDate || ''} data-category={course.category || ''} data-at-any-time={course.atAnyTime ? 'true' : 'false'}>
                <div class="course-card__image">
                  <img 
                    src={course.thumbImg?.url || '/images/ui/img_course-no-image-01.webp'} 
                    alt={course.title} 
                  />
                  <div class="course-card__status">
                    <span class="status-badge status-badge--dark-gray">å‹Ÿé›†çµ‚äº†</span>
                  </div>
                  {course.hasReport && (
                    <div class="course-card__report-ribbon">
                      <div class="report-ribbon__tail"></div>
                      <div class="report-ribbon__circle">
                        <div class="report-ribbon__text">
                          <span class="report-ribbon__text-line1">å®Ÿæ–½</span><br>
                          <span class="report-ribbon__text-line2">ãƒ¬ãƒãƒ¼ãƒˆ</span>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
                <div class="course-card__content">
                  {/* é–‹å‚¬æ—¥ */}
                  {(course.scheduleDate || course.atAnyTime) && (
                    <p class="course-card__schedule-date">
                      {course.atAnyTime ? 'éšæ™‚é–‹å‚¬' : formatExecutedDate(course.scheduleDate)}
                      {course.startTime && !course.atAnyTime && (
                        <span class="course-card__time">
                          {' '}{course.startTime}ã€œ{course.endTime || ''}
                        </span>
                      )}
                    </p>
                  )}
                  <div class="course-card__header">
                    <h3 class="course-card__title">{course.title}</h3>
                    <div class="course-card__arrow"></div>
                  </div>
                  {/* ã‚«ãƒ†ã‚´ãƒªãƒ¼å */}
                  {course.category && (
                    <div class="course-card__category">
                      <span class="category-tag">#{(() => {
                        if (typeof course.category === 'object' && course.category?.category) {
                          return course.category.category;
                        } else if (course.category) {
                          return String(course.category);
                        } else {
                          return 'ãã®ä»–';
                        }
                      })()}</span>
                    </div>
                  )}
                  {/* å¸‚å¤–ä½æ°‘å‚åŠ å¯å¦æ–‡è¨€ */}
                  {course.residencyText && (
                    <p class="course-card__residency">{course.residencyText}</p>
                  )}
                  {course.targetGrades.length > 0 && (
                    <div class="course-card__grades">
                      {(() => {
                        const { sortedGrades } = formatTargetGrades(course.targetGrades);
                        return sortedGrades.map(grade => (
                          <span class={`target-grade target-grade--${getGradeColorClass(grade)}`}>{grade}</span>
                        ));
                      })()}
                    </div>
                  )}
                  {/* ä¿è­·è€…å‚åŠ æ–‡è¨€ */}
                  {course.parentJoinText && (
                    <p class="course-card__parent-join">{course.parentJoinText}</p>
                  )}
                </div>
              </a>
              ))}
            </div>
            </div>
          </div>
        ) : (
          <div class="empty-state">
            <div class="empty-state__icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                <path d="M6 12v5c3 3 9 3 12 0v-5"/>
              </svg>
            </div>
            <p class="empty-state__description">
              ç¾åœ¨ã€{actualYear}ã®è¬›åº§ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>
              è¬›åº§ãŒæ±ºã¾ã‚Šæ¬¡ç¬¬ã€éšæ™‚æ²è¼‰ã„ãŸã—ã¾ã™ã®ã§ã€<br class="u-br-sm">ãŠå¾…ã¡ãã ã•ã„ã€‚
            </p>
          </div>
        )}
      </div>
    </section>

  </main>
</BaseLayout>

<style lang="scss">
@import "../../../../styles/index";

// ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ”ãƒ³ã‚¯è‰²ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
.hero {
  position: relative;
  padding: 0;
  background: linear-gradient(to bottom, $brand-sub-pink 0%, $background-primary 70%, $background-primary 100%);
  border-radius: 0 rem(120) 0 0;
  
  @include breakpoint-up(md) {
    border-radius: 0 rem(240) 0 0;
  }

  &__container {
    margin: 0 auto;
    padding: 0 0 0 5%;
    overflow: hidden;
    position: relative;
    
    @include breakpoint-up(xl) {
      padding: 0 0 0 rem(50);
    }

    &::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background-color: $brand-pink;
      z-index: -1;
    }
  }

  &__content {
    position: relative;
    padding: rem(100) 0 0;

    @include breakpoint-up(md) {
      padding: rem(120) 0 0;
    }
    @include breakpoint-up(xl) {
      padding: rem(160) 0 0;
    }
  }

  &__text {
    max-width: none;
    margin: 0;
    text-align: left;
  }

  &__title {
    @include font-ja-2l(semibold);
    font-weight: bold;
    color: $text-primary;
    margin: 0 0 rem(8) 0;
    line-height: 1.4;

    @include breakpoint-up(lg) {
      @include font-ja-3l(semibold);
      margin-bottom: rem(12);
    }

    .hero__title-line1 {
      display: block;
      @include font-ja-m(semibold);
      margin-bottom: rem(8);

      @include breakpoint-up(lg) {
        @include font-ja-l(semibold);
      }
    }

    .hero__title-line2 {
      display: block;
      @include font-ja-2l(semibold);
      font-weight: bold;
      line-height: 1.4;

      @include breakpoint-up(lg) {
        @include font-ja-3l(semibold);
      }
    }
  }

  &__subtitle {
    @include font-en-s(semibold);
    color: $brand-pink;
    margin: 0 0 rem(30) 0;
    font-weight: 500;
    letter-spacing: 0.05em;

    @include breakpoint-up(lg) {
      @include font-en-m(semibold);
      margin-bottom: 0;
    }
  }
}

.breadcrumb {
  padding: rem(20) 0;
  background: $background-primary;
  @include breakpoint-up(lg) {
    padding: rem(50) 0 rem(20);
  }

  &__container {
    margin: 0 auto;
    padding: 0 0 0 5%;
    @include breakpoint-up(xl) {
      padding: 0 0 0 rem(50);
    }
  }

  &__list {
    display: flex;
    align-items: center;
    gap: rem(8);
    list-style: none;
    margin: 0;
    padding: 0;
    flex-wrap: wrap;
    @include font-ja-3s;
  }

  &__item {
    display: flex;
    align-items: center;

    &:not(:last-child)::after {
      content: '>';
      margin-left: rem(8);
      color: $text-secondary;
    }

    a {
      @include font-ja-3s(semibold);
      color: $text-link;
      text-decoration: underline;

      &:hover {
        color: $text-link-hover;
        text-decoration: underline;
      }
    }

    &[aria-current="page"] {
      @include font-ja-3s;
      color: $text-primary;
      font-weight: 500;
    }
  }
}

/* å…±é€šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
.content-section {
  padding: 0 0 rem(120);
  background: $background-primary;
  position: relative;
  
  @include breakpoint-up(xl) {
    padding: 0 0 rem(160);
  }

  &__container {
    padding: 0 3%;
    overflow: hidden;
    @include breakpoint-up(xl) {
      padding: 0 rem(50);
    }
  }
}

/* è¬›åº§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.courses-section {
  background: $brand-sub-pink-low;
}

/* è¬›åº§ã‚°ãƒªãƒƒãƒ‰ */
.courses-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: rem(12);
  padding-bottom: rem(32);
  
  @include breakpoint-up(md) {
    gap: rem(18);
    padding-bottom: rem(40);
  }
  
  @include breakpoint-up(lg) {
    grid-template-columns: repeat(3, 1fr);
  }
  @include breakpoint-up(xl) {
    max-width: rem(1400);
    margin: 0 auto;
    gap: rem(24);
    padding-bottom: rem(48);
  }
  
  // æ—¥ä»˜ã‚¿ãƒ–è¡¨ç¤ºæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«
  &.date-grouped {
    display: block !important;
    
    // å­è¦ç´ ã®ã‚«ãƒ¼ãƒ‰ã«ã¯å½±éŸ¿ã—ãªã„ã‚ˆã†ã€ç›´æ¥ã®ã‚°ãƒªãƒƒãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
    grid-template-columns: none !important;
    gap: 0 !important;
  }
}

/* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¿ãƒ– */
.filter-tabs {
  display: flex;
  gap: rem(4);
  z-index: 10;
  justify-content: center;
  width: 100%;
  @include breakpoint-up(lg) {
    gap: rem(10);
  }
}

.filter-tab {
  @include font-ja-s(semibold);
  padding: rem(12) rem(16);
  background: $background-secondary;
  color: $text-primary;
  border-radius: $radius-m $radius-m 0 0;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  border: none;
  
  @include breakpoint-up(md) {
    @include font-ja-s(semibold);
    padding: rem(14) rem(20);
  }
  
  &:hover {
    background: darken($background-secondary, 5%);
  }
  
  &--active {
    background: $background-primary;
    color: $text-primary;
    
    // æ–‡å­—ã®ä¸‹ã«ãƒ”ãƒ³ã‚¯ã®ä¸‹ç·š
    &::after {
      content: '';
      position: absolute;
      bottom: rem(8);
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - #{rem(32)});
      height: rem(3);
      background: $brand-pink;
      border-radius: rem(2);
    }
    
    @include breakpoint-up(md) {
      &::after {
        bottom: rem(10);
        width: calc(100% - #{rem(40)});
      }
    }
    
    &:hover {
      background: $background-primary;
    }
  }
}

.courses-container {
  background: $background-primary;
  border-radius: $radius-l;
  padding: rem(20) rem(12);
  
  @include breakpoint-up(md) {
    padding: rem(20);
    border-radius: $radius-2l;
  }
  
  @include breakpoint-up(lg) {
    padding: rem(25);
  }
  
  @include breakpoint-up(xl) {
    padding: rem(25) rem(40);
    max-width: rem(1480);
    margin: 0 auto;
  }
}

/* å‡¡ä¾‹ */
.course-legend {
  display: flex;
  gap: rem(20);
  margin: rem(16) auto rem(20);
  align-items: center;
  justify-content: center;
  
  @include breakpoint-up(md) {
    margin: rem(20) 0 rem(24) 0;
    gap: rem(24);
  }
  
  &__item {
    display: flex;
    align-items: center;
    gap: rem(8);
  }
  
  &__color {
    width: rem(16);
    height: rem(16);
    border-radius: rem(4);
    flex-shrink: 0;
    
    @include breakpoint-up(md) {
      width: rem(20);
      height: rem(20);
      border-radius: rem(6);
    }
    
    &--job-experience {
      background-color: $brand-sub-yellow-very-low;
    }
    
    &--hands-on {
      background-color: $brand-sub-purple-very-low;
    }
  }
  
  &__label {
    @include font-ja-s(semibold);
    color: $text-primary;
    
    @include breakpoint-up(lg) {
      @include font-ja-m(semibold);
    }
  }
}

/* æ™‚æœŸåˆ¥ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ */
.period-scroll-links {
  display: flex;
  flex-wrap: wrap;
  gap: rem(8);
  justify-content: center;
  margin: rem(16) 0 rem(24) 0;
  
  @include breakpoint-up(md) {
    gap: rem(12);
    margin: rem(20) 0 rem(30) 0;
  }
  
}

.period-link {
  display: inline-flex;
  align-items: center;
  gap: rem(3);
  @include font-ja-3s(semibold);
  padding: rem(2) rem(6);
  border: 1px solid $brand-black;
  border-radius: rem(7);
  white-space: nowrap;
  color: $text-primary;
  background-color: $background-primary;
  text-decoration: none;
  transition: all 0.2s ease;
  
  @include breakpoint-up(md) {
    padding: rem(3) rem(8);
  }
  
  @include breakpoint-up(lg) {
    @include font-ja-2s(semibold);
  }
  
  &:hover {
    background-color: $brand-black;
    color: $background-primary;
    text-decoration: none;
  }
  
  &__arrow {
    width: rem(6);
    height: rem(6);
    border-right: 2px solid currentColor;
    border-bottom: 2px solid currentColor;
    transform: rotate(45deg) translateY(rem(-2));
    flex-shrink: 0;
    margin-left: rem(2);
    
    @include breakpoint-up(lg) {
      width: rem(8);
      height: rem(8);
      transform: rotate(45deg) translateY(rem(-2));
    }
  }
}

/* ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ã‚° */
.category-tag {
  font-size: rem(9);
  font-weight: 600;
  padding: rem(1) rem(3);
  border: 1px solid $brand-black;
  border-radius: rem(7);
  white-space: nowrap;
  color: $text-primary;
  background-color: $background-primary;
  display: inline-block;
  
  @include breakpoint-up(md) {
    @include font-ja-3s(semibold);
  }
  
  @include breakpoint-up(lg) {
    @include font-ja-2s(semibold);
    padding: rem(4) rem(6);
    border-radius: rem(10);
  }
}

/* ã‚³ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ */
.course-card {
  background: $background-primary;
  border-radius: $radius-m;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  text-decoration: none;
  color: inherit;
  display: flex;
  flex-direction: column;
  height: 100%;
  @include breakpoint-up(md) {
    border-radius: $radius-l;
  }
  
  
  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    text-decoration: none;
  }
  
  &__image {
    position: relative;
    aspect-ratio: 4 / 3;
    overflow: hidden;
    border-radius: $radius-m;

    @include breakpoint-up(md) {
      border-radius: $radius-l;
      aspect-ratio: 16 / 9;
    }
    
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.2) 5%, transparent 100%);
      pointer-events: none;
      z-index: 1;
    }
    
    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
  }
  
  &__status {
    position: absolute;
    top: rem(8);
    left: rem(8);
    z-index: 2;
    display: inline-block;
    line-height: 1;
    @include breakpoint-up(md) {
      top: rem(10);
      left: rem(10);
    }
    @include breakpoint-up(lg) {
      top: rem(12);
      left: rem(12);
    }
    
    img {
      height: rem(24);
      width: auto;
      
      @include breakpoint-up(md) {
        height: rem(32);
      }
    }
  }
  
  &__report-ribbon {
    position: absolute;
    bottom: rem(16);
    right: rem(8);
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    
    @include breakpoint-up(md) {
      bottom: rem(20);
      right: rem(10);
    }
    
    @include breakpoint-up(lg) {
      bottom: rem(24);
      right: rem(12);
    }
    
    @include breakpoint-up(xl) {
      bottom: rem(32);
    }
  }
  
  &__content {
    padding: rem(12) rem(8) rem(16);
    display: flex;
    flex-direction: column;
    flex: 1;
    
    @include breakpoint-up(md) {
      padding: rem(16) rem(16) rem(20);
    }
    
    @include breakpoint-up(lg) {
      padding: rem(20) rem(20) rem(30);
    }
  }
  
  &__schedule-date {
    font-size: rem(9);
    font-weight: 600;
    color: $text-dark-gray;
    margin: 0 0 rem(8) 0;
    line-height: 1.4;
    @include breakpoint-up(md) {
      @include font-ja-2s(semibold);
    }
    
    @include breakpoint-up(md) {
      margin-bottom: rem(10);
    }
    
    @include breakpoint-up(lg) {
      margin-bottom: rem(12);
    }
  }
  
  &__time {
    color: $text-dark-gray;
    font-weight: 600;
  }
  
  &__executed-date {
    @include font-ja-3s(semibold);
    color: $text-dark-gray;
    margin: 0 0 rem(8) 0;
    line-height: 1.4;
    @include breakpoint-up(md) {
      @include font-ja-2s(semibold);
    }
    
    @include breakpoint-up(md) {
      margin-bottom: rem(10);
    }
    
    @include breakpoint-up(lg) {
      margin-bottom: rem(12);
    }
  }
  
  &__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: rem(8);
    margin-bottom: rem(8);
    @include breakpoint-up(md) {
      margin-bottom: rem(12);
    }
  }
  
  &__title {
    @include font-ja-2s(semibold);
    color: $text-primary;
    margin: 0;
    line-height: 1.4;
    flex: 1;
    
    @include breakpoint-up(md) {
      @include font-ja-s(semibold);
    }
    
    @include breakpoint-up(lg) {
      @include font-ja-m(semibold);
    }
  }
  
  &__arrow {
    width: rem(20);
    height: rem(20);
    background-color: $brand-pink;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.3s ease;
    
    @include breakpoint-up(md) {
      width: rem(24);
      height: rem(24);
    }
    
    &::after {
      content: '';
      width: rem(6);
      height: rem(6);
      border-right: 2px solid $text-white;
      border-bottom: 2px solid $text-white;
      transform: translateX(rem(-1)) rotate(-45deg);
      
      @include breakpoint-up(md) {
        width: rem(8);
        height: rem(8);
        transform: translateX(rem(-1)) rotate(-45deg);
      }
    }
  }
  
  &:hover &__arrow {
    transform: translateX(rem(2));
  }
  
  &:hover &__image img {
    transform: scale(1.1);
  }
  
  
  &__category {
    margin: 0;
    @include breakpoint-up(md) {
      margin: 0 0 rem(8) 0;
    }
  }
  
  &__residency {
    @include font-ja-3s(semibold);
    color: $text-dark-gray;
    margin: rem(8) 0 rem(2) 0;
    line-height: 1.4;
    @include breakpoint-up(md) {
      margin: rem(8) 0 rem(4) 0;
    }
  }
  
  &__grades {
    display: flex;
    flex-wrap: wrap;
    gap: rem(2);
    
    @include breakpoint-up(md) {
      gap: rem(6);
    }
  }
  
  &__parent-join {
    @include font-ja-3s(semibold);
    color: $text-dark-gray;
    margin: 0 0 0 0;
    line-height: 1.4;
    @include breakpoint-up(md) {
      margin: rem(2) 0 0 0;
    }
  }
}

/* å®Ÿæ–½ãƒ¬ãƒãƒ¼ãƒˆãƒªãƒœãƒ³ */
.report-ribbon {
  &__tail {
    position: absolute;
    left: 50%;
    top: rem(30);
    transform: translateX(-50%);
    height: 0;
    width: 0;
    border-top: rem(12) solid $text-white;
    border-left: rem(12) solid $text-white;
    border-right: rem(12) solid $text-white;
    border-bottom: rem(12) solid transparent;
    border-radius: 0 0 rem(3) rem(3);
    z-index: 1;
    
    @include breakpoint-up(md) {
      top: rem(38);
    }
    @include breakpoint-up(lg) {
      top: rem(44);
    }
    @include breakpoint-up(xl) {
      top: rem(60);
      border-top: rem(18) solid $text-white;
      border-left: rem(18) solid $text-white;
      border-right: rem(18) solid $text-white;
      border-bottom: rem(18) solid transparent;
      border-radius: 0 0 rem(5) rem(5);
    }
  }
  
  &__circle {
    width: rem(40);
    height: rem(40);
    background-color: $brand-primary;
    border: 2px solid $text-white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 2;
    
    @include breakpoint-up(md) {
      width: rem(48);
      height: rem(48);
    }
    @include breakpoint-up(lg) {
      width: rem(52);
      height: rem(52);
    }
    @include breakpoint-up(xl) {
      width: rem(70);
      height: rem(70);
    }
  }
  
  &__text {
    color: $text-white;
    text-align: center;
    line-height: 0.6;
    padding-bottom: rem(4);
    @include breakpoint-up(md) {
      line-height: 0.7;
      padding-bottom: rem(4);
    }
    @include breakpoint-up(lg) {
      padding-bottom: 0;
    }
    @include breakpoint-up(xl) {
      line-height: 1;
      padding-bottom: rem(2);
    }
  }
  
  &__text-line1 {
    @include font-ja-3s(semibold);
    
    @include breakpoint-up(lg) {
      @include font-ja-s(semibold);
      margin-top: rem(-1);
    }
  }
  
  &__text-line2 {
    @include font-ja-4s(semibold);
    margin-top: rem(-2);
    
    @include breakpoint-up(xl) {
      @include font-ja-3s(semibold);
      margin-top: 0;
    }
  }
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
.status-badge {
  @include font-ja-3s(semibold);
  color: $text-white;
  padding: rem(2) rem(4);
  border-radius: $radius-xs;
  white-space: nowrap;
  
  @include breakpoint-up(md) {
    @include font-ja-2s(semibold);
  }
  
  &--dark-gray {
    background: $background-dark-gray;
  }
  
  &--brand-secondary {
    background: $brand-secondary;
  }
  
  &--brand-turquoise {
    background: $brand-turquoise;
  }
  
  &--brand-pink {
    background: $brand-pink;
  }
}

/* å­¦å¹´ã‚¿ã‚°ï¼ˆscheduleãƒšãƒ¼ã‚¸ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ */
/* ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ã‚° */
.category-tag {
  font-size: rem(9);
  font-weight: 600;
  padding: rem(1) rem(3);
  border: 1px solid $brand-black;
  border-radius: rem(7);
  white-space: nowrap;
  color: $text-primary;
  background-color: $background-primary;
  display: inline-block;
  
  @include breakpoint-up(md) {
    @include font-ja-3s(semibold);
  }
  
  @include breakpoint-up(lg) {
    @include font-ja-2s(semibold);
    padding: rem(4) rem(6);
    border-radius: rem(10);
  }
}

.target-grade {
  font-size: rem(9);
  font-weight: 600;
  padding: rem(1) rem(3);
  border: 1px solid $brand-black;
  border-radius: rem(7);
  white-space: nowrap;
  margin-bottom: rem(2);
  color: $text-primary;
  
  @include breakpoint-up(md) {
    @include font-ja-3s(semibold);
  }
  
  @include breakpoint-up(lg) {
    @include font-ja-2s(semibold);
    padding: rem(4) rem(6);
    border-radius: rem(10);
  }
  
  &--elementary-low {
    background-color: $brand-sub-yellow-low;
    color: $text-primary;
  }
  
  &--elementary-high {
    background-color: $brand-sub-purple-low;
    color: $text-primary;
  }
  
  &--junior {
    background-color: $brand-sub-turquoise-low;
    color: $text-primary;
  }
  
  &--high-school {
    background-color: #9db7d6;
    color: $text-primary;
  }
  
  &--special {
    background-color: $brand-sub-pink-low;
    color: $text-primary;
  }
  
  // ã‚€ãªã‹ãŸå­ã©ã‚‚å¤§å­¦ã®æ—¥ç”¨ï¼ˆå­¦æ ¡åè¡¨ç¤ºï¼‰
  &--mku-day {
    background-color: $background-primary;
    border: 1px solid $brand-black;
    color: $text-primary;
  }
}

/* ç©ºçŠ¶æ…‹ */
.empty-state {
  text-align: center;
  padding: rem(40) 0 0;
  
  @include breakpoint-up(md) {
    // padding: rem(80);
  }
  
  &__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-bottom: rem(32);
    
    @include breakpoint-up(md) {
      margin-bottom: rem(40);
    }
    
    svg {
      width: rem(60);
      height: rem(60);
      color: $brand-pink;
      
      @include breakpoint-up(md) {
        width: rem(80);
        height: rem(80);
      }
    }
  }
  
  &__description {
    @include font-ja-s;
    color: $text-primary;
    line-height: 1.7;
    margin: 0;
  }
}

// ã‚«ãƒ¼ãƒ‰ã®è‰²åˆ†ã‘ï¼ˆcourseTypeãƒ™ãƒ¼ã‚¹ï¼‰
div.courses-grid a.course-card.course-card--è·æ¥­ä½“é¨“ {
  background: $brand-sub-yellow-very-low !important;
}

div.courses-grid a.course-card.course-card--ä½“é¨“æ´»å‹• {
  background: $brand-sub-purple-very-low !important;
}

/* æ—¥ä»˜ã‚°ãƒ«ãƒ¼ãƒ— */
.date-group {
  margin-bottom: rem(32);
  
  @include breakpoint-up(md) {
    margin-bottom: rem(40);
  }
}

.date-group__header {
  margin-top: rem(40);
  margin-bottom: rem(16);
  text-align: left;
  
  @include breakpoint-up(md) {
    margin-bottom: rem(20);
  }
  
  @include breakpoint-up(lg) {
    margin-top: rem(54);
  }
  
  @include breakpoint-up(xl) {
    margin-top: rem(64);
  }
}

h3.date-group__title {
  @include font-ja-m(semibold);
  color: $text-secondary !important;
  margin: 0 !important;
  line-height: 1.4 !important;
  font-weight: 600 !important;
  
  @include breakpoint-up(lg) {
    @include font-ja-l(semibold);
  }
}

.date-group__grid {
  display: grid !important;
  grid-template-columns: repeat(2, 1fr) !important;
  gap: rem(12) !important;
  
  @include breakpoint-up(md) {
    gap: rem(18) !important;
  }
  
  @include breakpoint-up(lg) {
    grid-template-columns: repeat(3, 1fr) !important;
    gap: rem(24) !important;
  }
  
  @include breakpoint-up(xl) {
    max-width: rem(1400) !important;
    margin: 0 auto !important;
    gap: rem(24) !important;
  }
}
</style>

<script>
// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®Intersection Observer
document.addEventListener('DOMContentLoaded', function() {
  const observerOptions = {
    threshold: 0.1, // è¦ç´ ã®10%ãŒè¦‹ãˆãŸã‚‰ç™ºç«
    rootMargin: '0px 0px -50px 0px' // ä¸‹ã‹ã‚‰50pxä½™è£•ã‚’æŒãŸã›ã‚‹
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        // ä¸€åº¦è¡¨ç¤ºã•ã‚ŒãŸã‚‰ç›£è¦–ã‚’åœæ­¢ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // fade-upã‚¯ãƒ©ã‚¹ã‚’æŒã¤å…¨ã¦ã®è¦ç´ ã‚’ç›£è¦–å¯¾è±¡ã«è¿½åŠ 
  const fadeUpElements = document.querySelectorAll('.fade-up');
  fadeUpElements.forEach(element => {
    observer.observe(element);
  });

});
</script>

<script>
// è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ï¼ˆãƒšãƒ¼ã‚¸å†…ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
document.addEventListener('DOMContentLoaded', function() {
  const navLinks = document.querySelectorAll('.page-nav__link');
  
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      const href = this.getAttribute('href');
      const targetId = href?.substring(1);
      const targetElement = targetId ? document.getElementById(targetId) : null;
      
      if (targetElement) {
        const headerHeight = 80; // ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•åˆ†ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
        const elementPosition = targetElement.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - headerHeight;

        window.scrollTo({
          top: offsetPosition,
          behavior: 'smooth'
        });
      }
    });
  });

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ï¼ˆå®Œå…¨ç‰ˆï¼‰
  const filterTabs = document.querySelectorAll('.filter-tab');
  const coursesGrid = document.querySelector('#courses-grid');
  const periodScrollLinks = document.querySelector('#period-scroll-links');
  
  if (filterTabs.length === 0 || !coursesGrid) return;
  
  // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆAPIãƒ¬ã‚³ãƒ¼ãƒ‰é †ï¼‰ã‚’HTMLã‹ã‚‰å–å¾—
  const categoryOrderData = periodScrollLinks?.getAttribute('data-category-order');
  const categoryOrder = categoryOrderData ? JSON.parse(categoryOrderData) : [];
  
  // å…ƒã®ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜
  const originalCards = Array.from(coursesGrid.children);
  
  // ãƒ‡ãƒãƒƒã‚°ï¼šå„ã‚«ãƒ¼ãƒ‰ã®dataå±æ€§ã‚’ç¢ºèª
  console.log('All cards data attributes:');
  originalCards.forEach((card, index) => {
    const title = card.querySelector('.course-card__title')?.textContent || 'No title';
    console.log(`Card ${index} (${title}):`, {
      scheduleDate: card.dataset.scheduleDate,
      scheduleDateLength: card.dataset.scheduleDate?.length,
      scheduleDateIsEmpty: card.dataset.scheduleDate === '' || card.dataset.scheduleDate === null || card.dataset.scheduleDate === undefined,
      atAnyTime: card.dataset.atAnyTime,
      category: card.dataset.category,
      hasAtAnyTimeAttribute: card.hasAttribute('data-at-any-time'),
      atAnyTimeValue: card.getAttribute('data-at-any-time')
    });
  });
  
  // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
  function formatDateForDisplay(dateString) {
    if (!dateString) return '';
    
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    
    const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
    const weekday = weekdays[date.getDay()];
    
    return `${year}å¹´${month}æœˆ${day}æ—¥(${weekday})`;
  }
  
  // æ—¥ä»˜ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹é–¢æ•°
  function groupByDate(cards) {
    const groups = {};
    
    cards.forEach((card, index) => {
      const dateAttr = card.dataset.scheduleDate;
      const atAnyTime = card.dataset.atAnyTime === 'true';
      const title = card.querySelector('.course-card__title')?.textContent || 'No title';
      console.log(`Card ${index} (${title.substring(0, 20)}...):`, {
        dateAttr,
        atAnyTime,
        datasetAtAnyTime: card.dataset.atAnyTime,
        hasAtAnyTimeAttr: card.hasAttribute('data-at-any-time')
      });
      
      let groupKey;
      if (atAnyTime) {
        // éšæ™‚é–‹å‚¬ã®å ´åˆ
        console.log(`ğŸ¯ Card "${title.substring(0, 20)}..." assigned to éšæ™‚é–‹å‚¬ group`);
        groupKey = 'éšæ™‚é–‹å‚¬';
      } else if (dateAttr && dateAttr.trim() !== '') {
        // æ—¥ä»˜æŒ‡å®šã®å ´åˆ
        console.log(`ğŸ“… Processing date for "${title.substring(0, 20)}...": "${dateAttr}"`);
        const formattedDate = formatDateForDisplay(dateAttr);
        console.log(`ğŸ“… Formatted date: "${formattedDate}"`);
        if (!formattedDate) {
          console.log(`âŒ Skipping card "${title.substring(0, 20)}..." - invalid date format`);
          return;
        }
        groupKey = formattedDate;
      } else {
        // æ—¥ä»˜ã‚‚atAnyTimeã‚‚è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€Œéå»ã®å®Ÿç¸¾ã€ã¨ã—ã¦æ‰±ã†
        console.log(`ğŸ“ Card "${title.substring(0, 20)}..." has no date, assigning to éå»ã®å®Ÿç¸¾`);
        groupKey = 'éå»ã®å®Ÿç¸¾';
      }
      
      console.log('Group key:', groupKey);
      if (!groups[groupKey]) {
        groups[groupKey] = [];
      }
      groups[groupKey].push(card);
    });
    
    console.log('Final groups:', groups);
    return groups;
  }
  
  // æ—¥ä»˜ã‚°ãƒ«ãƒ¼ãƒ—è¡¨ç¤ºã‚’ä½œæˆ
  function renderDateGroups(groups) {
    console.log('renderDateGroups called with:', groups);
    coursesGrid.innerHTML = '';
    coursesGrid.classList.add('date-grouped');
    
    // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆï¼ˆã€Œéšæ™‚é–‹å‚¬ã€ã¯æœ€å¾Œï¼‰
    const sortedDates = Object.keys(groups).sort((a, b) => {
      // ã€Œéšæ™‚é–‹å‚¬ã€ã¯å¸¸ã«æœ€å¾Œ
      if (a === 'éšæ™‚é–‹å‚¬') return 1;
      if (b === 'éšæ™‚é–‹å‚¬') return -1;
      
      // ä¸¡æ–¹ã¨ã‚‚æ—¥ä»˜ã®å ´åˆã¯æ—¥ä»˜é †
      const dateA = new Date(groups[a][0].dataset.scheduleDate);
      const dateB = new Date(groups[b][0].dataset.scheduleDate);
      return dateA - dateB;
    });
    
    console.log('sortedDates:', sortedDates);
    
    sortedDates.forEach(date => {
      const dateGroup = document.createElement('div');
      dateGroup.className = 'date-group';
      
      const header = document.createElement('div');
      header.className = 'date-group__header';
      header.style.marginTop = '40px';
      header.style.marginBottom = '16px';
      header.style.textAlign = 'left';
      
      const title = document.createElement('h3');
      title.className = 'date-group__title';
      title.style.margin = '0';
      title.style.color = '#1c0083'; // $text-secondary
      title.style.fontWeight = '600'; // semibold
      title.style.lineHeight = '1.4';
      title.textContent = date;
      
      const grid = document.createElement('div');
      grid.className = 'date-group__grid';
      grid.style.display = 'grid';
      
      // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
      function setResponsiveStyles() {
        const width = window.innerWidth;
        if (width >= 1200) { // xlä»¥é™
          title.style.fontSize = '32px'; // ja-l
          grid.style.gridTemplateColumns = 'repeat(3, 1fr)';
          grid.style.gap = '24px';
          header.style.marginTop = '64px';
          header.style.marginBottom = '20px';
        } else if (width >= 1024) { // lg~xlæœªæº€
          title.style.fontSize = '32px'; // ja-l
          grid.style.gridTemplateColumns = 'repeat(3, 1fr)';
          grid.style.gap = '18px';
          header.style.marginTop = '54px';
          header.style.marginBottom = '20px';
        } else if (width >= 768) { // md~lgæœªæº€
          title.style.fontSize = '20px'; // ja-m
          grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
          grid.style.gap = '18px';
          header.style.marginTop = '40px';
          header.style.marginBottom = '20px';
        } else { // smæœªæº€
          title.style.fontSize = '20px'; // ja-m
          grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
          grid.style.gap = '12px';
          header.style.marginTop = '40px';
          header.style.marginBottom = '16px';
        }
      }
      
      setResponsiveStyles();
      window.addEventListener('resize', setResponsiveStyles);
      
      header.appendChild(title);
      dateGroup.appendChild(header);
      dateGroup.appendChild(grid);
      
      groups[date].forEach(card => {
        grid.appendChild(card);
      });
      
      coursesGrid.appendChild(dateGroup);
    });
  }
  
  // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹é–¢æ•°
  function groupByCategory(cards) {
    const groups = {};
    
    cards.forEach(card => {
      // .category-tagè¦ç´ ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªåã‚’å–å¾—ï¼ˆ#ã‚’é™¤å»ï¼‰
      const categoryTagElement = card.querySelector('.category-tag');
      const category = categoryTagElement ? 
        categoryTagElement.textContent.replace('#', '').trim() : 'ãã®ä»–';
      
      if (!groups[category]) {
        groups[category] = [];
      }
      groups[category].push(card);
    });
    
    return groups;
  }
  
  // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—è¡¨ç¤º
  function renderCategoryGroups(groups) {
    coursesGrid.innerHTML = '';
    coursesGrid.classList.add('date-grouped'); // åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’APIãƒ¬ã‚³ãƒ¼ãƒ‰é †ã«ã‚½ãƒ¼ãƒˆ
    const categoryNames = Object.keys(groups);
    const sortedCategories = categoryOrder.filter(catName => categoryNames.includes(catName));
    
    console.log('sortedCategories:', sortedCategories);
    
    sortedCategories.forEach(category => {
      const categoryGroup = document.createElement('div');
      categoryGroup.className = 'date-group';
      
      const header = document.createElement('div');
      header.className = 'date-group__header';
      header.style.marginTop = '40px';
      header.style.marginBottom = '16px';
      header.style.textAlign = 'left';
      
      const title = document.createElement('h3');
      title.className = 'date-group__title';
      title.style.margin = '0';
      title.style.color = '#1c0083'; // $text-secondary
      title.style.fontWeight = '600'; // semibold
      title.style.lineHeight = '1.4';
      title.textContent = String(category);
      
      const grid = document.createElement('div');
      grid.className = 'date-group__grid';
      grid.style.display = 'grid';
      
      // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
      function setResponsiveStyles() {
        const width = window.innerWidth;
        if (width >= 1200) { // xlä»¥é™
          title.style.fontSize = '32px'; // ja-l
          grid.style.gridTemplateColumns = 'repeat(3, 1fr)';
          grid.style.gap = '24px';
          header.style.marginTop = '64px';
          header.style.marginBottom = '20px';
        } else if (width >= 1024) { // lg~xlæœªæº€
          title.style.fontSize = '32px'; // ja-l
          grid.style.gridTemplateColumns = 'repeat(3, 1fr)';
          grid.style.gap = '18px';
          header.style.marginTop = '54px';
          header.style.marginBottom = '20px';
        } else if (width >= 768) { // md~lgæœªæº€
          title.style.fontSize = '20px'; // ja-m
          grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
          grid.style.gap = '18px';
          header.style.marginTop = '40px';
          header.style.marginBottom = '20px';
        } else { // smæœªæº€
          title.style.fontSize = '20px'; // ja-m
          grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
          grid.style.gap = '12px';
          header.style.marginTop = '32px';
          header.style.marginBottom = '16px';
        }
      }
      
      setResponsiveStyles();
      window.addEventListener('resize', setResponsiveStyles);
      
      header.appendChild(title);
      categoryGroup.appendChild(header);
      categoryGroup.appendChild(grid);
      
      groups[category].forEach(card => {
        grid.appendChild(card);
      });
      
      coursesGrid.appendChild(categoryGroup);
    });
  }
  
  // æ—¥ä»˜ã‚’æ™‚æœŸã«åˆ†é¡ã™ã‚‹é–¢æ•°
  function getDatePeriod(dateString) {
    if (!dateString) return null;
    
    const date = new Date(dateString);
    const month = date.getMonth() + 1; // 0ãƒ™ãƒ¼ã‚¹ãªã®ã§+1
    const day = date.getDate();
    
    if (month === 7 && day >= 15) {
      return 'late-july';
    } else if (month === 8 && day >= 1 && day <= 10) {
      return 'early-august';
    } else if (month === 8 && day >= 11 && day <= 20) {
      return 'mid-august';
    } else if (month === 8 && day >= 21 && day <= 31) {
      return 'late-august';
    }
    
    return null;
  }

  // æ—¥ä»˜ã‚¿ãƒ–ç”¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
  function attachDateScrollListeners() {
    const periodLinks = document.querySelectorAll('.period-link');
    
    periodLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const period = this.dataset.period;
        let targetElement = null;
        
        if (period === 'anytime') {
          // éšæ™‚é–‹å‚¬ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ¢ã™
          targetElement = document.querySelector('.date-group__header:last-child');
          const headers = document.querySelectorAll('.date-group__header');
          headers.forEach(header => {
            if (header.textContent.includes('éšæ™‚é–‹å‚¬')) {
              targetElement = header;
            }
          });
        } else {
          // æŒ‡å®šã•ã‚ŒãŸæ™‚æœŸã®æœ€åˆã®æ—¥ä»˜ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ¢ã™
          const dateHeaders = document.querySelectorAll('.date-group__header');
          dateHeaders.forEach(header => {
            const headerText = header.textContent;
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’æŠ½å‡ºã—ã¦æ™‚æœŸåˆ¤å®š
            const dateMatch = headerText.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);
            if (dateMatch) {
              const [, year, month, day] = dateMatch;
              const dateString = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
              const headerPeriod = getDatePeriod(dateString);
              if (headerPeriod === period && !targetElement) {
                targetElement = header;
              }
            }
          });
        }
        
        if (targetElement) {
          // ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•åˆ†ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆxlä»¥ä¸Šã§ã¯è¿½åŠ ãƒãƒ¼ã‚¸ãƒ³ï¼‰
          const isXlOrLarger = window.innerWidth >= 1280;
          const headerHeight = isXlOrLarger ? 120 : 80;
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - headerHeight;

          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      });
    });
  }

  // æ—¥ä»˜ã‚¿ãƒ–ç”¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã‚’å¾©å…ƒã™ã‚‹é–¢æ•°
  function updateDateScrollLinks() {
    console.log('updateDateScrollLinks called');
    const periodScrollLinks = document.querySelector('#period-scroll-links');
    if (!periodScrollLinks) return;
    
    // æ—¢å­˜ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªã‚¢
    periodScrollLinks.innerHTML = '';
    
    // æ—¥ä»˜ã‚¿ãƒ–ç”¨ã®é™çš„ãªãƒœã‚¿ãƒ³ã‚’ä½œæˆ
    const dateButtons = [
      { period: 'late-july', text: '7æœˆä¸‹æ—¬' },
      { period: 'early-august', text: '8æœˆä¸Šæ—¬' },
      { period: 'mid-august', text: '8æœˆä¸­æ—¬' },
      { period: 'late-august', text: '8æœˆä¸‹æ—¬' },
      { period: 'anytime', text: 'éšæ™‚é–‹å‚¬' }
    ];
    
    dateButtons.forEach(buttonData => {
      const link = document.createElement('a');
      link.className = 'period-link';
      link.href = '#';
      link.dataset.period = buttonData.period;
      
      // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ï¼ˆåŸºæœ¬ã¯12pxã€lgä»¥ä¸Šã¯14pxï¼‰
      link.style.display = 'inline-flex';
      link.style.alignItems = 'center';
      link.style.gap = '6px';
      link.style.fontSize = '12px';
      link.style.fontWeight = '600';
      link.style.padding = '4px 12px 4px 8px';
      link.style.border = '1px solid #1c0083';
      link.style.borderRadius = '10px';
      link.style.whiteSpace = 'nowrap';
      link.style.color = '#1c0083';
      link.style.backgroundColor = '#ffffff';
      link.style.textDecoration = 'none';
      link.style.transition = 'all 0.2s ease';
      link.style.cursor = 'pointer';
      
      // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆlgä»¥ä¸Šã§ã¯14pxï¼‰
      const updateResponsiveStyles = () => {
        const width = window.innerWidth;
        if (width >= 1024) { // lgä»¥ä¸Š
          link.style.fontSize = '14px';
        } else {
          link.style.fontSize = '12px';
        }
      };
      updateResponsiveStyles();
      window.addEventListener('resize', updateResponsiveStyles);
      
      // ã‚¢ãƒ­ãƒ¼è¦ç´ ã‚’ä½œæˆï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰
      const arrow = document.createElement('span');
      arrow.className = 'period-link__arrow';
      
      // ã‚¢ãƒ­ãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
      const updateArrowStyles = () => {
        const width = window.innerWidth;
        if (width >= 1024) { // lgä»¥ä¸Š
          arrow.style.width = '8px';
          arrow.style.height = '8px';
          arrow.style.transform = 'rotate(45deg) translateY(-2px)';
        } else {
          arrow.style.width = '6px';
          arrow.style.height = '6px';
          arrow.style.transform = 'rotate(45deg) translateY(-2px)';
        }
        arrow.style.borderRight = '2px solid currentColor';
        arrow.style.borderBottom = '2px solid currentColor';
        arrow.style.flexShrink = '0';
        arrow.style.marginLeft = '0px';
      };
      updateArrowStyles();
      window.addEventListener('resize', updateArrowStyles);
      
      // ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¢ãƒ­ãƒ¼ã‚’è¿½åŠ 
      link.textContent = buttonData.text;
      link.appendChild(arrow);
      
      // ãƒ›ãƒãƒ¼åŠ¹æœã‚’è¿½åŠ 
      link.addEventListener('mouseenter', function() {
        this.style.backgroundColor = '#1c0083';
        this.style.color = '#ffffff';
      });
      
      link.addEventListener('mouseleave', function() {
        this.style.backgroundColor = '#ffffff';
        this.style.color = '#1c0083';
      });
      
      periodScrollLinks.appendChild(link);
    });
    
    // æ–°ã—ãä½œæˆã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒ
    attachDateScrollListeners();
    
    console.log('Date scroll links restored');
  }

  // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateCategoryScrollLinks(categoryGroups) {
    const periodScrollLinks = document.querySelector('#period-scroll-links');
    if (!periodScrollLinks) return;
    
    // æ—¢å­˜ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªã‚¢
    periodScrollLinks.innerHTML = '';
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼åã‚’APIãƒ¬ã‚³ãƒ¼ãƒ‰é †ã«ã‚½ãƒ¼ãƒˆ
    const categoryNames = Object.keys(categoryGroups);
    const sortedCategories = categoryOrder.filter(catName => categoryNames.includes(catName));
    
    sortedCategories.forEach(category => {
      const link = document.createElement('a');
      link.className = 'period-link';
      link.href = '#';
      link.dataset.category = category;
      
      // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ï¼ˆåŸºæœ¬ã¯12pxã€lgä»¥ä¸Šã¯14pxï¼‰
      link.style.display = 'inline-flex';
      link.style.alignItems = 'center';
      link.style.gap = '6px';
      link.style.fontSize = '12px';
      link.style.fontWeight = '600';
      link.style.padding = '4px 12px 4px 8px';
      link.style.border = '1px solid #1c0083';
      link.style.borderRadius = '10px';
      link.style.whiteSpace = 'nowrap';
      link.style.color = '#1c0083';
      link.style.backgroundColor = '#ffffff';
      link.style.textDecoration = 'none';
      link.style.transition = 'all 0.2s ease';
      link.style.cursor = 'pointer';
      
      // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆlgä»¥ä¸Šã§ã¯14pxï¼‰
      const updateResponsiveStylesCategory = () => {
        const width = window.innerWidth;
        if (width >= 1024) { // lgä»¥ä¸Š
          link.style.fontSize = '14px';
        } else {
          link.style.fontSize = '12px';
        }
      };
      updateResponsiveStylesCategory();
      window.addEventListener('resize', updateResponsiveStylesCategory);
      
      // ã‚¢ãƒ­ãƒ¼è¦ç´ ã‚’ä½œæˆï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰
      const arrow = document.createElement('span');
      arrow.className = 'period-link__arrow';
      
      // ã‚¢ãƒ­ãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
      const updateArrowStyles = () => {
        const width = window.innerWidth;
        if (width >= 1024) { // lgä»¥ä¸Š
          arrow.style.width = '8px';
          arrow.style.height = '8px';
          arrow.style.transform = 'rotate(45deg) translateY(-2px)';
        } else {
          arrow.style.width = '6px';
          arrow.style.height = '6px';
          arrow.style.transform = 'rotate(45deg) translateY(-2px)';
        }
        arrow.style.borderRight = '2px solid currentColor';
        arrow.style.borderBottom = '2px solid currentColor';
        arrow.style.flexShrink = '0';
        arrow.style.marginLeft = '0px';
      };
      updateArrowStyles();
      window.addEventListener('resize', updateArrowStyles);
      
      // ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¢ãƒ­ãƒ¼ã‚’è¿½åŠ 
      link.textContent = '#' + String(category);
      link.appendChild(arrow);
      
      // ãƒ›ãƒãƒ¼åŠ¹æœã‚’è¿½åŠ 
      link.addEventListener('mouseenter', function() {
        this.style.backgroundColor = '#1c0083';
        this.style.color = '#ffffff';
      });
      
      link.addEventListener('mouseleave', function() {
        this.style.backgroundColor = '#ffffff';
        this.style.color = '#1c0083';
      });
      
      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’è¿½åŠ 
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const headers = document.querySelectorAll('.date-group__header');
        let targetElement = null;
        
        headers.forEach(header => {
          const titleElement = header.querySelector('.date-group__title');
          if (titleElement && titleElement.textContent === category) {
            targetElement = header;
          }
        });
        
        if (targetElement) {
          // ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•åˆ†ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆxlä»¥ä¸Šã§ã¯è¿½åŠ ãƒãƒ¼ã‚¸ãƒ³ï¼‰
          const isXlOrLarger = window.innerWidth >= 1280;
          const headerHeight = isXlOrLarger ? 120 : 80;
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - headerHeight;

          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      });
      
      periodScrollLinks.appendChild(link);
    });
  }
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã‚’è¿½åŠ 
  filterTabs.forEach(tab => {
    tab.addEventListener('click', function() {
      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
      filterTabs.forEach(t => t.classList.remove('filter-tab--active'));
      this.classList.add('filter-tab--active');
      
      const sortType = this.dataset.sort;
      
      if (sortType === 'date') {
        // æ—¥ä»˜ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
        const dateGroups = groupByDate(originalCards);
        renderDateGroups(dateGroups);
        // æ—¥ä»˜ã‚¿ãƒ–ç”¨ã®é™çš„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã«å¾©å…ƒ
        updateDateScrollLinks();
        if (periodScrollLinks) {
          periodScrollLinks.style.display = 'flex';
        }
      } else if (sortType === 'category') {
        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
        const categoryGroups = groupByCategory(originalCards);
        renderCategoryGroups(categoryGroups);
        // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã‚’æ›´æ–°
        updateCategoryScrollLinks(categoryGroups);
        if (periodScrollLinks) {
          periodScrollLinks.style.display = 'flex';
        }
      }
    });
  });
  
  // åˆæœŸè¡¨ç¤ºã¯æ—¥ä»˜ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã®ã§ã€æ—¥ä»˜ã‚°ãƒ«ãƒ¼ãƒ—è¡¨ç¤ºã«ã™ã‚‹
  const dateGroups = groupByDate(originalCards);
  renderDateGroups(dateGroups);
  // åˆæœŸè¡¨ç¤ºæ™‚ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒ
  updateDateScrollLinks();
  
  // é™çš„è¦ç´ ã«ã‚‚ãƒ›ãƒãƒ¼åŠ¹æœã‚’è¿½åŠ 
  const existingLinks = document.querySelectorAll('.period-link');
  existingLinks.forEach(link => {
    link.addEventListener('mouseenter', function() {
      this.style.backgroundColor = '#1c0083';
      this.style.color = '#ffffff';
    });
    
    link.addEventListener('mouseleave', function() {
      this.style.backgroundColor = '#ffffff';
      this.style.color = '#1c0083';
    });
  });
});
</script>

<style lang="scss">
@import "../../../../styles/index";

/* ã‚¹ãƒãƒ›ã®ã¿æ”¹è¡Œã‚’è¡¨ç¤º */
.sm-only {
  @include breakpoint-up(md) {
    display: none;
  }
}

// courses-title-wrapperã®å…¨ç”»é¢å¹…ã§padding-leftã‚’ç„¡åŠ¹åŒ–
:global(.content-section__title-wrapper.courses-title-wrapper) {
  padding-left: 0 !important;
}
</style>