---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Breadcrumb from '@/components/Breadcrumb.astro';
import { 
  getSummerCourseById,
  getSummerCourses,
  getGlobalSettings,
} from '@/lib/microcms';
import { convertYearToPath, convertPathToYear } from '@/utils/yearConverter';
import { formatDateForCourse } from '@/utils/dateUtils';

// é™çš„ãƒ‘ã‚¹ç”Ÿæˆ
export async function getStaticPaths() {
  try {
    // å…¨ã¦ã®å¤ã®èª²å¤–æˆæ¥­ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆå¹´åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãªã—ã§å…¨ä»¶å–å¾—ï¼‰
    const allCourses = await getSummerCourses();
    
    if (!allCourses || allCourses.length === 0) {
      return [];
    }

    // å„è¬›åº§ã®ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
    const paths = [];
    
    allCourses.forEach(course => {
      const courseYear = Array.isArray(course.year) ? course.year[0] : course.year;
      const pathYear = convertYearToPath(courseYear);
      
      // scheduleãŒå­˜åœ¨ã—ã€è¤‡æ•°ã®é–‹å‚¬æ—¥ãŒã‚ã‚‹å ´åˆã¯åˆ†å‰²
      if (course.schedule && course.schedule.length > 0) {
        course.schedule.forEach((scheduleItem, index) => {
          const scheduleIndex = index + 1;
          const urlSuffix = course.schedule.length > 1 ? `-${scheduleIndex}` : '';
          
          paths.push({
            params: { 
              year: pathYear,
              id: `${course.id}${urlSuffix}`
            },
            props: { 
              course, 
              originalYear: courseYear, 
              scheduleIndex: scheduleIndex,
              scheduleItem: scheduleItem
            }
          });
        });
      } else {
        // scheduleãŒå­˜åœ¨ã—ãªã„å ´åˆã¯å¾“æ¥é€šã‚Š
        paths.push({
          params: { 
            year: pathYear,
            id: course.id 
          },
          props: { 
            course, 
            originalYear: courseYear,
            scheduleIndex: 1,
            scheduleItem: null
          }
        });
      }
    });

    return paths;
  } catch (error) {
    console.error('Error generating static paths:', error);
    return [];
  }
}

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
const { year, id } = Astro.params;
const { course, originalYear, scheduleIndex, scheduleItem } = Astro.props;

// IDã‹ã‚‰å®Ÿéš›ã®è¬›åº§IDã¨é–‹å‚¬å›ã‚’è§£æ
const [courseId, urlScheduleIndex] = id.includes('-') ? id.split('-') : [id, '1'];
const actualScheduleIndex = parseInt(urlScheduleIndex);

// ãƒ‘ã‚¹ã‹ã‚‰å¹´åº¦ã‚’å¾©å…ƒ
const actualYear = originalYear || convertPathToYear(year);

if (!year || !id) {
  return Astro.redirect('/404');
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã‚’å–å¾—
const globalSettings = await getGlobalSettings();
const currentYear = Array.isArray(globalSettings.currentYear) ? globalSettings.currentYear[0] : globalSettings.currentYear;
const currentYearValue = currentYear;

// è¬›åº§ãƒ‡ãƒ¼ã‚¿ã¯æ—¢ã«propsã‹ã‚‰å–å¾—æ¸ˆã¿
if (!course) {
  return Astro.redirect('/404');
}

// è¬›åº§ã®å¹´åº¦ã‚’ç¢ºèª
const courseYear = Array.isArray(course.year) ? course.year[0] : course.year;

// URLã®å¹´åº¦ã¨è¬›åº§ã®å¹´åº¦ãŒä¸€è‡´ã—ãªã„å ´åˆã¯404
if (courseYear !== actualYear) {
  return Astro.redirect('/404');
}

// è©²å½“ã™ã‚‹é–‹å‚¬å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
let displayScheduleItem = scheduleItem;
if (!displayScheduleItem && course.schedule && course.schedule.length > 0) {
  displayScheduleItem = course.schedule[actualScheduleIndex - 1];
}

// ãƒšãƒ¼ã‚¸æƒ…å ±
const scheduleText = displayScheduleItem && course.schedule && course.schedule.length > 1 
  ? ` (ç¬¬${actualScheduleIndex}å›)` 
  : '';
const pageTitle = `${course.title}${scheduleText} | å¤ã®èª²å¤–æˆæ¥­`;
const pageDescription = course.subtitle || `${course.title}ã®è©³ç´°æƒ…å ±ã§ã™ã€‚`;

// ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ
const currentYearPath = convertYearToPath(currentYear);
const breadcrumbItems = [
  { label: 'ãƒ›ãƒ¼ãƒ ', href: '/' },
  { label: 'è¬›åº§å†…å®¹', href: '/course' },
  { label: 'å¤ã®èª²å¤–æˆæ¥­', href: '/course/summer-course' },
  { label: actualYear, href: `/course/summer-course/${year}` },
  { label: `${course.title}${scheduleText}`, current: true }
];

// ãƒ•ã‚§ãƒ¼ã‚ºã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹é–¢æ•°
function convertPhaseToStatus(phase: string): string {
  switch (phase) {
    case 'å‹Ÿé›†å‰':
      return 'å‹Ÿé›†å‰';
    case 'å‹Ÿé›†ç· åˆ‡':
      return 'å‹Ÿé›†ç· åˆ‡';
    case 'å‹Ÿé›†å—ä»˜ä¸­':
      return 'å‹Ÿé›†å—ä»˜ä¸­';
    case 'çµ‚äº†':
      return 'çµ‚äº†';
    default:
      return 'æº–å‚™ä¸­';
  }
}

// è¬›åº§ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°
function getCourseStatus(course: any, scheduleItem: any, currentYearValue: string): string {
  // è¬›åº§ã®å¹´åº¦ã‚’å–å¾—
  const courseYearValue = Array.isArray(course.year) ? course.year[0] : course.year;
  
  // ç¾åœ¨å¹´åº¦ä»¥å¤–ã®è¬›åº§ï¼ˆéå»ã®å®Ÿç¸¾ï¼‰ã¯å¼·åˆ¶çš„ã«ã€Œå‹Ÿé›†çµ‚äº†ã€
  if (courseYearValue !== currentYearValue) {
    return 'å‹Ÿé›†çµ‚äº†';
  }
  
  // é–‹å‚¬æ—¥ã”ã¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
  if (scheduleItem && scheduleItem.subStatus) {
    const subStatus = Array.isArray(scheduleItem.subStatus) ? scheduleItem.subStatus[0] : scheduleItem.subStatus;
    return convertPhaseToStatus(subStatus);
  }
  
  // è¬›åº§å…¨ä½“ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
  if (course.status && Array.isArray(course.status) && course.status.length > 0) {
    return course.status[0];
  }
  
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æº–å‚™ä¸­
  return 'æº–å‚™ä¸­';
}

// YouTubeã¾ãŸã¯Vimeoã®URLã‹ã‚‰åŸ‹ã‚è¾¼ã¿ç”¨URLã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function getEmbedUrl(url: string): string | null {
  if (!url) return null;
  
  // YouTube
  if (url.includes('youtube.com/watch?v=') || url.includes('youtu.be/')) {
    const videoId = url.includes('youtu.be/') 
      ? url.split('youtu.be/')[1].split('?')[0]
      : url.split('v=')[1].split('&')[0];
    return `https://www.youtube.com/embed/${videoId}`;
  }
  
  // Vimeo
  if (url.includes('vimeo.com/')) {
    const videoId = url.split('vimeo.com/')[1].split('?')[0];
    return `https://player.vimeo.com/video/${videoId}`;
  }
  
  return null;
}

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã®èƒŒæ™¯è‰²ã‚¯ãƒ©ã‚¹å–å¾—é–¢æ•°
function getStatusColorClass(status: string): string {
  switch (status) {
    case 'å‹Ÿé›†å‰':
    case 'å‹Ÿé›†ç· åˆ‡':
    case 'çµ‚äº†':
      return 'status-badge--dark-gray';
    case 'å‹Ÿé›†å—ä»˜ä¸­':
      return 'status-badge--brand-secondary';
    default:
      return 'status-badge--dark-gray';
  }
}

// å­¦å¹´ã®è‰²åˆ†ã‘ã‚¯ãƒ©ã‚¹å–å¾—é–¢æ•°
function getGradeColorClass(grade: string): string {
  // ç‰¹æ®Šãªã‚±ãƒ¼ã‚¹
  if (grade === 'æœªå°±å­¦å…' || grade === 'ã ã‚Œã§ã‚‚' || grade.includes('ãã®ä»–')) {
    return 'special';
  }
  
  // æ•°å­—ã‚’æŠ½å‡º
  const yearMatch = grade.match(/^(\d+)å¹´$/);
  if (yearMatch && yearMatch[1]) {
    const num = parseInt(yearMatch[1]);
    if (num >= 1 && num <= 3) return 'elementary-low';    // 1~3å¹´
    if (num >= 4 && num <= 6) return 'elementary-high';   // 4~6å¹´
    if (num >= 7 && num <= 9) return 'junior';            // 7~9å¹´
  }
  
  // é«˜æ ¡ç”Ÿ
  if (grade.match(/^é«˜\d+$/)) {
    return 'high-school'; // é«˜æ ¡ç”Ÿå°‚ç”¨ã®è‰²
  }
  
  // ãã®ä»–
  return 'special';
}

// UTCæ—¥ä»˜ã‚’JSTã«å¤‰æ›ã—ã¦æ—¥æœ¬èªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æ—¥ä»˜ã‚’ç”Ÿæˆ
function formatJapaneseDate(utcDateString: string): string {
  return formatDateForCourse(utcDateString);
}

// å­¦å¹´ã®æ•´åˆ—é †åºé–¢æ•°ï¼ˆscheduleãƒšãƒ¼ã‚¸ã¨åŒæ§˜ï¼‰
function formatTargetGrades(targetGrades: string | string[]): { sortedGrades: string[]; htmlString: string } {
  const grades = Array.isArray(targetGrades) ? targetGrades : [targetGrades];
  
  // å­¦å¹´ã®è¡¨ç¤ºé †ã‚’æ±ºã‚ã‚‹é–¢æ•°
  function getGradeOrder(grade: string): number {
    // æœªå°±å­¦å…ã¯æœ€åˆ
    if (grade === 'æœªå°±å­¦å…') {
      return 0;
    }
    
    // 1å¹´ï½9å¹´ï¼ˆå°ä¸­å­¦æ ¡ï¼‰
    const elementaryJuniorMatch = grade.match(/^(\d+)å¹´$/);
    if (elementaryJuniorMatch && elementaryJuniorMatch[1]) {
      const num = parseInt(elementaryJuniorMatch[1]);
      if (num >= 1 && num <= 9) {
        return num; // 1ï½9ã®é †åº
      }
    }
    
    // é«˜1ï½é«˜3ï¼ˆé«˜æ ¡ï¼‰
    const highSchoolMatch = grade.match(/^é«˜(\d+)$/);
    if (highSchoolMatch && highSchoolMatch[1]) {
      const num = parseInt(highSchoolMatch[1]);
      if (num >= 1 && num <= 3) {
        return 10 + num; // 11ï½13ã®é †åºï¼ˆ10 + 1ï½3ï¼‰
      }
    }
    
    // ãã®ä»–ã¯æœ€å¾Œ
    return 999;
  }
  
  // å­¦å¹´ã‚’æŒ‡å®šã•ã‚ŒãŸé †åºã§ã‚½ãƒ¼ãƒˆ
  const sortedGrades = grades.sort((a, b) => {
    return getGradeOrder(a) - getGradeOrder(b);
  });
  
  return {
    sortedGrades,
    htmlString: sortedGrades.join('ãƒ»') // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚
  };
}

// parentJoinå€¤ã®è¡¨ç¤ºç”¨å¤‰æ›
const parentJoinMapping: Record<string, string> = {
  'r0A1BukTIs': 'ä¿è­·è€…ã®æ–¹ã‚‚å‚åŠ ã§ãã¾ã™',
  '87MGdHzdV4': 'ä¿è­·è€…ã®æ–¹ã¯å‚åŠ ã§ãã¾ã›ã‚“',
  'FEytb3Ezyt': 'ä¿è­·è€…ã®æ–¹ã®å‚åŠ ãŒå¿…é ˆã§ã™'
};

function getParentJoinText(parentJoin: any): string {
  if (!parentJoin) return '';
  
  const parentJoinStr = typeof parentJoin === 'string' ? parentJoin : (Array.isArray(parentJoin) ? parentJoin[0] : '');
  
  if (parentJoinStr && parentJoinStr !== 'é¸æŠã—ã¦ãã ã•ã„' && parentJoinStr.trim() !== '') {
    const displayText = parentJoinMapping[parentJoinStr] || parentJoinStr;
    return displayText;
  }
  
  return '';
}

// å®Ÿæ–½ãƒ¬ãƒãƒ¼ãƒˆã®å­˜åœ¨åˆ¤å®š
const hasAfterReport = (course.afterImages && course.afterImages.length > 0) || course.instructor || course.afterReport || course.participantCount;
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <main class="course-detail">
    <!-- ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->
    <div class="course-detail__breadcrumb">
      <Breadcrumb items={breadcrumbItems} />
    </div>

    <!-- è¬›åº§æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="course-info-section">
      <div class="content-section__container">
        <div class="course-info">
          <div class="course-info__title-wrapper stripe">
            <div class="course-info__year">{actualYear}</div>
            <h1 class="course-info__title">{course.title}{scheduleText}</h1>
          </div>
          
          {course.subtitle && (
            <div class="course-info__subtitle" set:html={course.subtitle.replace(/\n/g, '<br>')}></div>
          )}
          
          <div class="course-info__image">
            <img 
              src={course.thumbImg?.url || '/images/ui/img_course-no-image-01.webp'} 
              alt={course.title} 
            />
          </div>
          
          <!-- å®Ÿæ–½ãƒ¬ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          {hasAfterReport && (
            <div class="course-info__after-report">
              <div class="after-report-content">
                <div class="after-report-inner">
                  <h2 class="course-info__after-report-title">å®Ÿæ–½ãƒ¬ãƒãƒ¼ãƒˆ</h2>
                  {course.afterImages && course.afterImages.length > 0 && (
                    <div class="after-report-section">
                      <div class="after-report-images">
                        {course.afterImages.map((image, index) => (
                          <div key={index} class="after-report-image">
                            <img src={image.url} alt={`å®Ÿæ–½ãƒ¬ãƒãƒ¼ãƒˆç”»åƒ ${index + 1}`} />
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                  
                  {course.instructor && (
                    <div class="after-report-section">
                      <h3 class="after-report-section-title">è¬›å¸«</h3>
                      <div class="after-report-instructor">
                        {course.instructor}
                      </div>
                    </div>
                  )}
                  
                  {course.afterReport && (
                    <div class="after-report-section">
                      <h4 class="after-report-section-title">å‚åŠ äº‹æ¥­è€…ã®æ„Ÿæƒ³</h4>
                      <div class="after-report-feedback rich-content" set:html={course.afterReport}></div>
                    </div>
                  )}
                  
                  {course.participantCount && (
                    <div class="after-report-section">
                      <h4 class="after-report-section-title">å‚åŠ äººæ•°</h4>
                      <div class="after-report-instructor">
                        {course.participantCount}äºº
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}
          
          <!-- è©³ç´°æƒ…å ±ï¼ˆ1ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
          <div class="course-info__content-wrapper">
            <div class="course-info__details">
              <div class="detail-item">
                <div class="detail-item__label">å‹Ÿé›†çŠ¶æ³ï¼š</div>
                <div class="detail-item__value">
                  {(() => {
                    const resolvedStatus = getCourseStatus(course, displayScheduleItem, currentYearValue);
                    return (
                      <span class={`status-badge ${getStatusColorClass(resolvedStatus || 'æº–å‚™ä¸­')}`}>
                        {resolvedStatus || 'æº–å‚™ä¸­'}
                      </span>
                    );
                  })()}
                </div>
              </div>
              
              {(displayScheduleItem && displayScheduleItem.date && !course.atAnyTime) || course.atAnyTime ? (
                <div class="detail-item">
                  <div class="detail-item__label">å®Ÿæ–½æ—¥æ™‚ï¼š</div>
                  <div class="detail-item__value">
                    {course.atAnyTime ? 'éšæ™‚é–‹å‚¬' : (
                      <>
                        {formatJapaneseDate(displayScheduleItem.date)}
                        {displayScheduleItem && (displayScheduleItem.startTime || displayScheduleItem.endTime) && (
                          <><br />{displayScheduleItem.startTime && displayScheduleItem.endTime ? 
                            `${displayScheduleItem.startTime}ï½${displayScheduleItem.endTime}` :
                            displayScheduleItem.startTime || displayScheduleItem.endTime
                          }</>
                        )}
                      </>
                    )}
                  </div>
                </div>
              ) : null}
              
              {course.capacity && course.capacity > 0 && (
                <div class="detail-item">
                  <div class="detail-item__label">å®šå“¡ï¼š</div>
                  <div class="detail-item__value">{course.capacity}äºº</div>
                </div>
              )}
              
              {(() => {
                // è¬›åº§ã‚«ãƒ¼ãƒ‰ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨
                let category;
                if (typeof course.category === 'object' && course.category !== null) {
                  // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã€categoryãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¢ºèª
                  category = course.category.category || String(course.category);
                } else {
                  // æ–‡å­—åˆ—ã®å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
                  category = course.category || 'ãã®ä»–';
                }
                return category && category !== 'ãã®ä»–' && (
                  <div class="detail-item">
                    <div class="detail-item__label">ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼š</div>
                    <div class="detail-item__value">
                      <span class="category-tag">#{category}</span>
                    </div>
                  </div>
                );
              })()}
              
              {course.courseType && course.courseType.length > 0 && (
                <div class="detail-item">
                  <div class="detail-item__label">è¬›åº§ç¨®åˆ¥ï¼š</div>
                  <div class="detail-item__value">
                    {Array.isArray(course.courseType) ? course.courseType.join('ã€') : course.courseType}
                  </div>
                </div>
              )}
              
              {course.providerItem && course.providerItem.length > 0 && (
                <div class="detail-item">
                  <div class="detail-item__label">
                    å”åŠ›å¤§å­¦ãƒ»<span class="u-br-sm-xl">ä¼æ¥­ãƒ»å›£ä½“ï¼š</span>
                  </div>
                  <div class="detail-item__value">
                    {course.providerItem.map((provider, index) => (
                      <div key={index} class="provider-item">
                        <div>{provider.providerName}</div>
                        {provider.providerUrl && (
                          <a href={provider.providerUrl} target="_blank" rel="noopener noreferrer" class="provider-link">
                            {provider.providerUrl}
                          </a>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}
              
              {course.targetGrades && course.targetGrades.length > 0 && (
                <div class="detail-item">
                  <div class="detail-item__label">å¯¾è±¡ï¼š</div>
                  <div class="detail-item__value">
                    <div class="target-description">
                      {course.cityOutsideOk ? 'å¸‚å†…åœ¨ä½ã€ã¾ãŸã¯å¸‚å¤–ã«ãŠä½ã¾ã„ã®' : 'å¸‚å†…ã«ãŠä½ã¾ã„ã®'}
                    </div>
                    <div class="target-grades">
                      {(() => {
                        const { sortedGrades } = formatTargetGrades(course.targetGrades);
                        return sortedGrades.map((grade, index) => (
                          <span key={index} class={`target-grade target-grade--${getGradeColorClass(grade)}`}>{grade}</span>
                        ));
                      })()}
                    </div>
                    {getParentJoinText(course.parentJoin) && (
                      <div class="parent-join-description">
                        â€»{getParentJoinText(course.parentJoin)}
                      </div>
                    )}
                  </div>
                </div>
              )}
              
              {course.participationFee && (
                <div class="detail-item">
                  <div class="detail-item__label">å‚åŠ è²»ï¼š</div>
                  <div class="detail-item__value" set:html={course.participationFee.replace(/\n/g, '<br>')}></div>
                </div>
              )}
              
              {course.venue && (
                <div class="detail-item">
                  <div class="detail-item__label">ä¼šå ´ï¼š</div>
                  <div class="detail-item__value" set:html={course.venue.replace(/\n/g, '<br>')}></div>
                </div>
              )}
              
              {course.address && (
                <div class="detail-item">
                  <div class="detail-item__label">ä½æ‰€ï¼š</div>
                  <div class="detail-item__value" set:html={course.address.replace(/\n/g, '<br>')}></div>
                </div>
              )}
              
              {course.applyMethod && (
                <div class="detail-item detail-item--highlighted">
                  <div class="detail-item__label">ç”³è¾¼æ–¹æ³•ï¼š</div>
                  <div class="detail-item__value" set:html={course.applyMethod.replace(/\n/g, '<br>')}></div>
                </div>
              )}
              
              {displayScheduleItem && displayScheduleItem.entryDeadline && (
                <div class="detail-item detail-item--highlighted">
                  <div class="detail-item__label">ç”³è¾¼ç· åˆ‡ï¼š</div>
                  <div class="detail-item__value" set:html={displayScheduleItem.entryDeadline.replace(/\n/g, '<br>')}></div>
                </div>
              )}
              
              {course.courseContact && (
                <div class="detail-item detail-item--highlighted">
                  <div class="detail-item__label">è¬›åº§é€£çµ¡å…ˆï¼š</div>
                  <div class="detail-item__value rich-content course-contact" set:html={course.courseContact}></div>
                </div>
              )}
              
              {course.preparation && (
                <div class="detail-item">
                  <div class="detail-item__label">æº–å‚™ç‰©ï¼š</div>
                  <div class="detail-item__value rich-content" set:html={course.preparation}></div>
                </div>
              )}
              
              {course.remarks && !hasAfterReport && (
                <div class="detail-item">
                  <div class="detail-item__label">ç‰¹è¨˜äº‹é …ï¼š</div>
                  <div class="detail-item__value rich-content" set:html={course.remarks}></div>
                </div>
              )}
              
              {course.note && (
                <div class="detail-item">
                  <div class="detail-item__label">å‚™è€ƒï¼š</div>
                  <div class="detail-item__value rich-content" set:html={course.note}></div>
                </div>
              )}
            </div>
          </div>
          
          <!-- é€£çµ¡äº‹é …ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          {!hasAfterReport && (
          <div class="course-info__notices">
            <h2 class="course-info__section-title">é€£çµ¡äº‹é …</h2>
            <div class="notices-content">
              <div class="notice-section__content rich-content">
                {course.noticeCourse ? (
                  <div set:html={course.noticeCourse}></div>
                ) : (
                  <p class="empty-notice">ã¾ã é€£çµ¡äº‹é …ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>é–‹å‚¬æ—¥å‰æ—¥ã¾ã§ã«ã“ã¾ã‚ã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                )}
              </div>
            </div>
          </div>
          )}
          
          
          <!-- æ³¨æ„äº‹é …ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
// PDF Canvasè¡¨ç¤ºæ©Ÿèƒ½
document.addEventListener('DOMContentLoaded', function() {
  console.log('PDF.js loaded:', typeof pdfjsLib !== 'undefined');
  
  // PDF.jsã®è¨­å®š
  if (typeof pdfjsLib !== 'undefined') {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    // PDFãƒªãƒ³ã‚¯ã‚’è‡ªå‹•çš„ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«å¤‰æ›
    const pdfLinks = document.querySelectorAll('.rich-content a[data-mime-type="application/pdf"]');
    console.log('PDF links found:', pdfLinks.length);
    
    pdfLinks.forEach(link => {
      const pdfUrl = link.href;
      const fileName = link.textContent.trim();
      
      // PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½œæˆ
      const pdfBlock = document.createElement('div');
      pdfBlock.className = 'pdf-canvas-block';
      pdfBlock.dataset.pdfUrl = pdfUrl;
      pdfBlock.innerHTML = `
        <div class="pdf-canvas-header">
          <h4>ğŸ“„ ${fileName}</h4>
          <div class="pdf-controls">
            <a href="${pdfUrl}" target="_blank">PDFã§é–‹ã</a>
          </div>
        </div>
        <div class="pdf-canvas-container">
          <div class="pdf-loading">PDFã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
          <div class="pdf-pages-container"></div>
        </div>
      `;
      
      // å…ƒã®ãƒªãƒ³ã‚¯ã‚’ç½®ãæ›ãˆ
      link.parentNode.replaceChild(pdfBlock, link);
    });
    
    // PDF Canvas ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‡¦ç†
    const pdfCanvasBlocks = document.querySelectorAll('.pdf-canvas-block');
    
    pdfCanvasBlocks.forEach(block => {
      const url = block.dataset.pdfUrl;
      const pagesContainer = block.querySelector('.pdf-pages-container');
      const loadingDiv = block.querySelector('.pdf-loading');
      
      if (!url || !pagesContainer) return;
      
      console.log('Loading PDF:', url);
      
      pdfjsLib.getDocument(url).promise.then(pdf => {
        console.log('PDF loaded. Pages:', pdf.numPages);
        loadingDiv.style.display = 'none';
        
        // å…¨ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
        for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
          pdf.getPage(pageNum).then(page => {
            const scale = 1.5;
            const viewport = page.getViewport({ scale });
            
            const canvas = document.createElement('canvas');
            canvas.className = 'pdf-page-canvas';
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            pagesContainer.appendChild(canvas);
            
            const renderContext = {
              canvasContext: context,
              viewport: viewport
            };
            
            page.render(renderContext).promise.then(() => {
              console.log(`Page ${pageNum} rendered`);
            }).catch(error => {
              console.error(`Error rendering page ${pageNum}:`, error);
            });
          });
        }
      }).catch(error => {
        console.error('Error loading PDF:', error);
        loadingDiv.textContent = 'PDFã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
        loadingDiv.style.color = '#ff0000';
      });
    });
  } else {
    console.error('PDF.js not loaded');
  }
});
</script>

<style lang="scss">
@import '../../../../../styles/_index';

.course-detail {
  min-height: 100vh;
  background-color: $brand-sub-pink-low;
  
  // ãƒ‰ãƒƒãƒˆæŸ„èƒŒæ™¯
  background-image: 
    radial-gradient(circle, $brand-sub-pink 1.5px, transparent 1.5px),
    radial-gradient(circle, $brand-sub-pink 1.5px, transparent 1.5px);
  background-position: 0 0, 6.5px 6.5px;
  background-size: 13px 13px;
}

.course-detail__breadcrumb {
  padding-top: rem(100);
  background: transparent;
  
  @include breakpoint-up(lg) {
    padding-top: rem(120);
  }
  
  :global(.breadcrumb) {
    background: transparent;
  }
  
  :global(.breadcrumb__list) {
    background: transparent;
  }
}

.course-info-section {
  padding: rem(40) 0 rem(80);
  
  @include breakpoint-up(lg) {
    padding: rem(60) 0 rem(120);
  }
  
  .content-section__container {
    padding: 0 5%;
    
    @include breakpoint-up(xl) {
      padding: 0 rem(50);
    }
  }
}

.course-info {
  background: $background-primary;
  border-radius: $radius-l;
  padding: rem(25) rem(15) rem(30);
  position: relative;
  overflow: visible;
  @include breakpoint-up(md) {
    padding: rem(25) rem(25) rem(30);
  }
  
  @include breakpoint-up(lg) {
    padding: rem(48);
    border-radius: $radius-2l;
  }
  @include breakpoint-up(xl) {
    max-width: rem(1260);
    margin: 0 auto;
  }
}

.course-info__title-wrapper {
  padding: rem(15);
  margin-bottom: rem(24);
  margin-left: calc(-1 * rem(15) - 2%);
  border-radius: rem(12);

  @include breakpoint-up(md) {
    padding: rem(15) rem(20);
    margin-left: calc(-1 * rem(25) - 2%);
  }
  
  @include breakpoint-up(lg) {
    padding: rem(24) rem(32);
    margin-bottom: rem(32);
    margin-left: calc(-1 * rem(48) - 2%);
    border-radius: rem(16);
  }
}

.stripe {
  background-image: repeating-linear-gradient(135deg, $brand-sub-pink, $brand-sub-pink 10px, #FFD7EB 10px, #FFD7EB 30px);
}

.course-info__year {
  @include font-ja-2s(semibold);
  color: $text-primary;
  margin-bottom: rem(3);
  
  @include breakpoint-up(sm) {
    @include font-ja-s(semibold);
  }
  
  @include breakpoint-up(lg) {
    @include font-ja-m(semibold);
  }
}

.course-info__title {
  @include font-ja-m(semibold);
  color: $text-primary;
  margin: 0;
  
  @include breakpoint-up(sm) {
    @include font-ja-l(semibold);
  }
  
  @include breakpoint-up(lg) {
    @include font-ja-2l(semibold);
  }
}

.course-info__subtitle {
  @include font-ja-s(semibold);
  color: $text-primary;
  margin-bottom: rem(24);
  
  @include breakpoint-up(lg) {
    @include font-ja-m(semibold);
    margin-bottom: rem(32);
  }
}

.course-info__image {
  margin-bottom: rem(32);
  position: relative;
  
  @include breakpoint-up(lg) {
    margin-bottom: rem(48);
  }
  
  img {
    width: 100%;
    height: auto;
    aspect-ratio: 16/9;
    object-fit: cover;
    border-radius: $radius-m;
    @include breakpoint-up(lg) {
      border-radius: $radius-l;
    }
  }
  
  // å·¦ä¸Šã®è£…é£¾ï¼ˆobjectsï¼‰
  &::before {
    content: '';
    position: absolute;
    top: rem(-15);
    left: rem(-10);
    width: rem(120);
    height: rem(120);
    background-image: url('/images/ui/img_decoration-objects-pink-01.svg');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: start;
    z-index: 10;
    
    @include breakpoint-up(md) {
      top: rem(-10);
      left: rem(-20);
      width: rem(160);
      height: rem(160);
    }
    
    @include breakpoint-up(lg) {
      top: rem(-10);
      left: rem(-20);
      width: 25%;
      height: rem(160);
    }
    
    @include breakpoint-up(xl) {
      top: rem(-10);
      left: rem(-20);
      width: 30%;
      height: rem(200);
    }
  }
  
  // å³ä¸‹ã®è£…é£¾ï¼ˆdotsï¼‰
  &::after {
    content: '';
    position: absolute;
    bottom: rem(-15);
    right: rem(-5);
    width: rem(160);
    height: rem(160);
    background-image: url('/images/ui/img_decoration-dots-pink-01.svg');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: bottom;
    z-index: 10;
    
    @include breakpoint-up(md) {
      bottom: rem(-20);
      right: rem(-20);
      width: rem(200);
      height: rem(200);
    }
  }
}

.course-info__content-wrapper {
  display: flex;
  flex-direction: column;
}

.course-info__details {
  width: 100%;
}

.detail-item {
  display: flex;
  flex-direction: column;
  padding-top: rem(14);
  padding-bottom: rem(18);
  border-bottom: 1px solid $border-secondary;
  
  @include breakpoint-up(sm) {
    flex-direction: row;
    align-items: flex-start;
  }
  
  &:last-child {
    margin-bottom: 0;
  }
  
  &--highlighted {
    background-color: #FFE6F3;
  }
}

.detail-item__label {
  @include font-ja-2s;
  color: $text-secondary;
  margin-bottom: rem(4);
  min-width: rem(120);
  padding-left: rem(5);
  
  @include breakpoint-up(sm) {
    margin-bottom: 0;
    margin-right: rem(16);
    width: rem(120);
    flex-shrink: 0;
  }
  
  @include breakpoint-up(lg) {
    width: rem(180);
    min-width: rem(180);
  }
}

.detail-item__value {
  @include font-ja-s(semibold);
  color: $text-primary;
  line-height: 1.6;
  flex: 1;
  padding-left: rem(15);
  padding-right: rem(15);

  @include breakpoint-up(sm) {
    padding-left: 0;
  }
}

// ä¿è­·è€…å‚åŠ æƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ«
.parent-join-description {
  @include font-ja-s;
  color: $text-primary;
  margin-top: rem(6);
  line-height: 1.6;
}

// ãƒªãƒƒãƒã‚¨ãƒ‡ã‚£ã‚¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆç‰¹è¨­è¬›åº§ã¨åŒæ§˜ï¼‰
.detail-item__value.rich-content {
  @include font-ja-s;
  max-width: 100%;
  overflow: hidden;
  word-wrap: break-word;
  
  :global(h3), :global(h4), :global(h5) {
    @include font-ja-s(semibold);
    color: $text-primary;
    margin: rem(16) 0 rem(8) 0;
    font-weight: 600 !important;
    font-size: inherit !important;
  }
  
  :global(p) {
    @include font-ja-s;
    color: $text-primary;
    margin: rem(8) 0;
    font-weight: 400 !important;
    
    &:first-child {
      margin-top: 0;
    }
    
    &:last-child {
      margin-bottom: 0;
    }
  }
  
  :global(strong), :global(b) {
    font-weight: 600 !important;
  }
  
  :global(*:first-child) {
    margin-top: 0 !important;
  }
  
  :global(*:last-child) {
    margin-bottom: 0 !important;
  }
  
  :global(ul), :global(ol) {
    margin: rem(8) 0;
    padding-left: rem(20);
  }
  
  :global(ul) {
    list-style-type: disc;
  }
  
  :global(ol) {
    list-style-type: decimal;
  }
  
  :global(li) {
    @include font-ja-s;
    color: $text-primary;
    margin-bottom: rem(4);
    font-weight: 400 !important;
    
    &:last-child {
      margin-bottom: 0;
    }
  }
  
  :global(iframe) {
    max-width: 100%;
    height: auto;
    border: none;
    border-radius: rem(8);
  }
  
  :global(img) {
    max-width: 100%;
    height: auto;
    
    @include breakpoint-up(lg) {
      max-width: 50%;
    }
  }
  
  :global(img) {
    width: 100% !important;
    height: auto !important;
    border-radius: rem(4);
    margin: rem(8) 0;
    display: block;
  }
  
  :global(figure) {
    display: block;
    margin: rem(8) 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    width: 100% !important;
    padding: 0;
    
    img {
      margin: 0;
      width: 100% !important;
      height: auto !important;
      display: block;
    }
  }
  
  :global(a) {
    @include font-ja-s(semibold);
    color: $text-link;
    text-decoration: underline;
    word-break: break-all;
    
    &:hover {
      color: $text-link-hover;
    }
  }
}

.provider-item {
  margin-bottom: rem(8);
  
  &:last-child {
    margin-bottom: 0;
  }
}

.provider-link {
  @include font-ja-s(semibold);
  color: $text-link;
  text-decoration: underline;
  word-break: break-all;
  
  &:hover {
    color: $text-link-hover;
  }
}

// ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ«
.category-tag {
  @include font-ja-3s(semibold);
  padding: rem(1) rem(3);
  border: 1px solid $brand-black;
  border-radius: rem(7);
  white-space: nowrap;
  color: $text-primary;
  background-color: $background-primary;
  display: inline-block;
  
  @include breakpoint-up(md) {
    @include font-ja-2s(semibold);
  }
}

// è¬›åº§é€£çµ¡å…ˆå†…ã®ç”»åƒã®ã‚¹ã‚¿ã‚¤ãƒ«
.course-contact {
  :global(img) {
    max-width: rem(180) !important;
    width: auto !important;
    height: auto !important;
  }
  
  :global(figure) {
    max-width: rem(180) !important;
    width: auto !important;
    
    img {
      max-width: rem(180) !important;
      width: auto !important;
    }
  }
}

.course-info__section-title {
  @include font-ja-m(semibold);
  color: $text-secondary;
  margin-bottom: rem(16);
  
  @include breakpoint-up(lg) {
    @include font-ja-l(semibold);
    margin-bottom: rem(24);
  }
}


// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè¬›åº§ã‚«ãƒ¼ãƒ‰ã¨åŒã˜ï¼‰
.status-badge {
  @include font-ja-3s(semibold);
  color: $text-white;
  padding: rem(2) rem(4);
  border-radius: $radius-xs;
  white-space: nowrap;
  display: inline-block;
  
  @include breakpoint-up(md) {
    @include font-ja-2s(semibold);
  }

  &--dark-gray {
    background: $background-dark-gray;
  }

  &--brand-secondary {
    background: $brand-secondary;
  }

  &--brand-turquoise {
    background: $brand-turquoise;
  }

  &--brand-pink {
    background: $brand-pink;
  }
}

// å¯¾è±¡å­¦å¹´ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«
.target-description {
  @include font-ja-s;
  color: $text-primary;
  margin-bottom: rem(8);
  line-height: 1.6;
}

// å­¦å¹´ã‚¿ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ«
.target-grades {
  display: flex;
  flex-wrap: wrap;
  gap: rem(6);
  margin-bottom: rem(6);
}

.target-grade {
  @include font-ja-2s(semibold);
  padding: rem(4) rem(6);
  border: 1px solid $brand-black;
  border-radius: rem(10);
  white-space: nowrap;
  margin-bottom: rem(2);

  &--elementary-low {
    background-color: $brand-sub-yellow-low;
  }

  &--elementary-high {
    background-color: $brand-sub-purple-low;
  }

  &--junior {
    background-color: $brand-sub-turquoise-low;
  }
  &--high-school {
    background-color: #9db7d6;
  }

  &--special {
    background-color: $brand-sub-pink-low;
  }
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æ”¹è¡Œãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ */
:global(.u-br-sm-xl) {
  display: inline;
  
  @include breakpoint-up(sm) {
    display: block;
  }
  
  @include breakpoint-up(xl) {
    display: inline;
  }
}

// é€£çµ¡äº‹é …ã‚»ã‚¯ã‚·ãƒ§ãƒ³
.course-info__notices {
  margin-top: rem(32);
  
  @include breakpoint-up(lg) {
    margin-top: rem(48);
  }
}

.notices-content {
  padding: rem(16);
  background-color: #ffffff;
  background-image: linear-gradient(90deg, #cccccc80 1px, transparent 1px), linear-gradient(#cccccc80 1px, transparent 1px);
  background-position: 10px 10px;
  background-size: 31px 31px;
  border-radius: rem(8);
  border: 1px solid $border-secondary;
}

.notice-section__content {
  @include font-ja-s;
  color: $text-primary;
  line-height: 1.6;
}

// notices-contentå†…ã®ãƒªãƒƒãƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¹ã‚¿ã‚¤ãƒ«
.notices-content .rich-content {
  @include font-ja-s;
  max-width: 100%;
  overflow: hidden;
  word-wrap: break-word;
  
  :global(*:first-child) {
    margin-top: 0 !important;
  }
  
  :global(h3), :global(h4), :global(h5) {
    @include font-ja-s(semibold);
    color: $text-primary;
    margin: rem(16) 0 rem(8) 0;
    font-weight: 600 !important;
    font-size: inherit !important;
  }
  
  :global(p) {
    @include font-ja-s;
    color: $text-primary;
    margin: rem(8) 0;
    font-weight: 400 !important;
    font-size: rem(16) !important;
    
    &:last-child {
      margin-bottom: 0;
    }
  }
  
  :global(img) {
    max-width: 100%;
    height: auto;
    
    @include breakpoint-up(lg) {
      max-width: 50%;
    }
  }
}

// ç©ºã®çŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ«
.notices-content .rich-content .empty-notice,
.preparation-content .rich-content .empty-notice {
  color: $text-primary !important;
  font-weight: 400 !important;
  margin: rem(8) 0 !important;
  font-size: var(--font-size-ja-s) !important;
  line-height: 1.6 !important;
  
  &:first-child {
    margin-top: 0 !important;
  }
  
  &:last-child {
    margin-bottom: 0 !important;
  }
}

// PDF ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«
:global(.pdf-canvas-block) {
  border: 1px solid $border-primary;
  border-radius: rem(8);
  margin: rem(16) 0;
  overflow: hidden;
  background: $background-primary;
  max-width: rem(1200);
}

:global(.pdf-canvas-header) {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  padding: rem(12) rem(16);
  background: $background-secondary;
  border-bottom: 1px solid $border-primary;
  flex-wrap: wrap;
  gap: rem(8);
  
  @include breakpoint-up(md) {
    flex-wrap: nowrap;
    gap: rem(16);
  }
  
  h4 {
    @include font-ja-2s(semibold);
    color: $text-primary;
    margin: 0;
    flex: 1;
    min-width: rem(200);
    word-break: break-word;
    
    @include breakpoint-up(md) {
      @include font-ja-s(semibold);
      min-width: auto;
    }
  }
  
  .pdf-controls {
    display: flex;
    gap: rem(4);
    align-items: center;
    flex-wrap: wrap;
    justify-content: flex-end;
    
    @include breakpoint-up(md) {
      gap: rem(8);
      flex-wrap: nowrap;
    }
    
    a {
      @include font-ja-3s(semibold);
      color: $text-link;
      text-decoration: underline;
      padding: rem(4) rem(8);
      border-radius: $radius-xs;
      white-space: nowrap;
      
      &:hover {
        color: $text-link-hover;
        background: $background-tertiary;
      }
      
      @include breakpoint-up(md) {
        @include font-ja-2s(semibold);
        padding: rem(6) rem(12);
      }
    }
    
    .page-info {
      @include font-ja-3s;
      color: $text-secondary;
      white-space: nowrap;
      
      @include breakpoint-up(md) {
        @include font-ja-2s;
      }
    }
  }
}

:global(.pdf-canvas-container) {
  position: relative;
  background: $brand-black;
  padding: rem(8);
  text-align: center;
  height: rem(300);
  overflow-y: auto;
  overflow-x: hidden;
  
  @include breakpoint-up(md) {
    padding: rem(16);
    height: rem(400);
  }
  
  @include breakpoint-up(lg) {
    padding: rem(20);
    height: rem(450);
  }
  
  .pdf-pages-container {
    display: flex;
    flex-direction: column;
    gap: rem(8);
    align-items: center;
  }
  
  .pdf-page-canvas {
    max-width: 100%;
    height: auto;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    border-radius: rem(4);
    display: block;
    margin: 0 auto;
    background: $text-white;
  }
  
  .pdf-loading {
    @include font-ja-2s;
    color: $text-secondary;
    padding: rem(20);
    
    @include breakpoint-up(md) {
      @include font-ja-s;
      padding: rem(40);
    }
  }
}

// æº–å‚™ç‰©ã‚»ã‚¯ã‚·ãƒ§ãƒ³
.course-info__preparation {
  margin-top: rem(32);
  
  @include breakpoint-up(lg) {
    margin-top: rem(48);
  }
}

.preparation-content {
  padding: rem(16);
  background-color: #ffffff;
  background-image: linear-gradient(90deg, #cccccc80 1px, transparent 1px), linear-gradient(#cccccc80 1px, transparent 1px);
  background-position: 10px 10px;
  background-size: 31px 31px;
  border-radius: rem(8);
  border: 1px solid $border-secondary;
}

// preparation-contentå†…ã®ãƒªãƒƒãƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¹ã‚¿ã‚¤ãƒ«
.preparation-content .rich-content {
  @include font-ja-s;
  max-width: 100%;
  overflow: hidden;
  word-wrap: break-word;
  
  :global(*:first-child) {
    margin-top: 0 !important;
  }
  
  :global(h3), :global(h4), :global(h5) {
    @include font-ja-s(semibold);
    color: $text-primary;
    margin: rem(16) 0 rem(8) 0;
    font-weight: 600 !important;
    font-size: inherit !important;
  }
  
  :global(p) {
    @include font-ja-s;
    color: $text-primary;
    margin: rem(8) 0;
    font-weight: 400 !important;
    
    &:last-child {
      margin-bottom: 0;
    }
  }
  
  :global(strong), :global(b) {
    font-weight: 600 !important;
  }
  
  :global(*:last-child) {
    margin-bottom: 0 !important;
  }
  
  :global(ul), :global(ol) {
    margin: rem(8) 0;
    padding-left: rem(20);
  }
  
  :global(ul) {
    list-style-type: disc;
  }
  
  :global(ol) {
    list-style-type: decimal;
  }
  
  :global(li) {
    @include font-ja-s;
    color: $text-primary;
    margin-bottom: rem(4);
    font-weight: 400 !important;
    
    &:last-child {
      margin-bottom: 0;
    }
  }
  
  :global(iframe) {
    max-width: 100%;
    height: auto;
    border: none;
    border-radius: rem(8);
  }
  
  :global(img) {
    width: 100% !important;
    height: auto !important;
    border-radius: rem(4);
    margin: rem(8) 0;
    display: block;
  }
  
  :global(figure) {
    display: block;
    margin: rem(8) 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    width: 100% !important;
    padding: 0;
    
    img {
      margin: 0;
      width: 100% !important;
      height: auto !important;
      display: block;
    }
  }
  
  :global(a) {
    @include font-ja-s(semibold);
    color: $text-link;
    text-decoration: underline;
    word-break: break-all;
    
    &:hover {
      color: $text-link-hover;
    }
  }
}

// å®Ÿæ–½ãƒ¬ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³
.course-info__after-report {
  margin-bottom: rem(32);
  
  @include breakpoint-up(lg) {
    margin-bottom: rem(48);
  }
}

.course-info__after-report-title {
  @include font-ja-m(semibold);
  color: $text-primary;
  margin-bottom: rem(16);
  background: linear-gradient(transparent 60%, $brand-sub-pink-low 60%);
  padding: rem(2) 0;
  display: inline-block;
  
  @include breakpoint-up(lg) {
    @include font-ja-l(semibold);
    margin-bottom: rem(24);
  }
}

.after-report-content {
  background-color: $brand-primary;
  border-radius: $radius-xs;
  padding: rem(6);
}

.after-report-inner {
  background-color: #ffffff;
  background-image: linear-gradient(90deg, #cccccc80 1px, transparent 1px), linear-gradient(#cccccc80 1px, transparent 1px);
  background-position: 10px 10px;
  background-size: 31px 31px;
  border-radius: $radius-m;
  padding: rem(16) rem(16) rem(30);

  @include breakpoint-up(md) {
    padding: rem(24) rem(24) rem(40);
  }

  @include breakpoint-up(lg) {
    padding: rem(30) rem(30) rem(50);
  }
  
  @include breakpoint-up(lg) {
    border-radius: $radius-l;
    padding: rem(40) rem(40) rem(60);
  }
}

.after-report-section {
  &:not(:last-child) {
    margin-bottom: rem(24);
    
    @include breakpoint-up(lg) {
      margin-bottom: rem(32);
    }
  }
}

.after-report-section-title {
  font-size: rem(16);
  font-weight: 600;
  color: $text-secondary;
  margin-bottom: rem(12);
  
  @include breakpoint-up(lg) {
    margin-bottom: rem(16);
    font-size: rem(20);
  }
}

.after-report-instructor {
  @include font-ja-s;
  color: $text-primary;
  line-height: 1.6;
}

// afterImagesã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
.after-report-images {
  display: flex;
  flex-direction: column;
  gap: rem(16);
  
  @include breakpoint-up(sm) {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: rem(16);
  }
  
  @include breakpoint-up(lg) {
    gap: rem(24);
  }
}

.after-report-image {
  img {
    width: 100%;
    height: auto;
    aspect-ratio: 16/9;
    object-fit: cover;
    border-radius: rem(8);
    
    @include breakpoint-up(lg) {
      border-radius: rem(12);
    }
  }
}

// å‚åŠ äº‹æ¥­è€…ã®æ„Ÿæƒ³ã®ãƒªãƒƒãƒã‚¨ãƒ‡ã‚£ã‚¿ã‚¹ã‚¿ã‚¤ãƒ«
.after-report-feedback.rich-content {
  max-width: 100%;
  overflow: hidden;
  word-wrap: break-word;
  
  :global(h3), :global(h4), :global(h5) {
    font-size: var(--font-size-ja-s) !important;
    font-weight: 600 !important;
    color: $text-primary;
    margin: rem(16) 0 rem(8) 0;
  }
  
  :global(p) {
    font-size: var(--font-size-ja-s) !important;
    color: $text-primary !important;
    margin: rem(8) 0 !important;
    font-weight: 400 !important;
    line-height: 1.6 !important;
    
    &:first-child {
      margin-top: 0 !important;
    }
    
    &:last-child {
      margin-bottom: 0 !important;
    }
  }
  
  :global(strong), :global(b) {
    font-weight: 600 !important;
  }
  
  :global(*:first-child) {
    margin-top: 0 !important;
  }
  
  :global(*:last-child) {
    margin-bottom: 0 !important;
  }
  
  :global(ul), :global(ol) {
    margin: rem(8) 0;
    padding-left: rem(20);
  }
  
  :global(ul) {
    list-style-type: disc;
  }
  
  :global(ol) {
    list-style-type: decimal;
  }
  
  :global(li) {
    font-size: var(--font-size-ja-s) !important;
    color: $text-primary;
    margin-bottom: rem(4);
    font-weight: 400 !important;
    
    &:last-child {
      margin-bottom: 0;
    }
  }
  
  :global(iframe) {
    max-width: 100%;
    height: auto;
    border: none;
    border-radius: rem(8);
  }
  
  :global(img) {
    width: 100% !important;
    height: auto !important;
    border-radius: rem(4);
    margin: rem(8) 0;
    display: block;
  }
  
  :global(figure) {
    display: block;
    margin: rem(8) 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    width: 100% !important;
    padding: 0;
    
    img {
      margin: 0;
      width: 100% !important;
      height: auto !important;
      display: block;
    }
  }
  
  :global(a) {
    font-size: var(--font-size-ja-s) !important;
    font-weight: 600 !important;
    color: $text-link;
    text-decoration: underline;
    word-break: break-all;
    
    &:hover {
      color: $text-link-hover;
    }
  }
}
</style>